# ç¬¬224ç« ï¼šã‚¨ãƒ©ãƒ¼ç›£è¦–ï¼ˆSentryç­‰ï¼‰ã®è€ƒãˆæ–¹ğŸ§¯

ã€Œæœ¬ç•ªã§ã‚¨ãƒ©ãƒ¼èµ·ãã¦ãŸã®ã«æ°—ã¥ã‹ãªã‹ã£ãŸâ€¦ğŸ˜±ã€ã‚’é˜²ãã®ãŒã€**ã‚¨ãƒ©ãƒ¼ç›£è¦–**ã ã‚ˆã€œï¼
Next.jsã‚¢ãƒ—ãƒªã¯å…¬é–‹ã—ã¦ã‹ã‚‰ãŒæœ¬ç•ªãªã®ã§ã€ã“ã“ã¯è¶…ã ã„ã˜ğŸ’ªğŸ’•

---

## 1) ã‚¨ãƒ©ãƒ¼ç›£è¦–ã£ã¦ãªã«ï¼Ÿãªã‚“ã§å¿…è¦ï¼ŸğŸ§ ğŸ””

é–‹ç™ºä¸­ã¯ `console.log()` ã‚„ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§æ°—ã¥ã‘ã‚‹ã‘ã©â€¦
æœ¬ç•ªã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç”»é¢ã§ã“ã£ãã‚Šå£Šã‚Œã¦ã¦ã‚‚ã€ã‚ãªãŸã¯æ°—ã¥ã‘ãªã„ã“ã¨ãŒã‚ã‚‹ã®ğŸ¥²

ãã“ã§ **Sentry** ã¿ãŸã„ãªç›£è¦–ãƒ„ãƒ¼ãƒ«ã‚’å…¥ã‚Œã‚‹ã¨ğŸ‘‡ã¿ãŸã„ã«åŠ©ã‹ã‚‹ï¼

* ã„ã¤ã‚¨ãƒ©ãƒ¼èµ·ããŸï¼Ÿâ°
* ã©ã®ãƒšãƒ¼ã‚¸ï¼Ÿã©ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ŸğŸ‘¤
* ã©ã®ç«¯æœ«ãƒ»ãƒ–ãƒ©ã‚¦ã‚¶ï¼ŸğŸ“±ğŸ’»
* ã©ã®ã‚³ãƒ¼ãƒ‰è¡Œï¼Ÿï¼ˆã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ï¼‰ğŸ§µ
* ä½•å›èµ·ãã¦ã‚‹ï¼Ÿã©ã‚ŒãŒãƒ¤ãƒã„ï¼ŸğŸ”¥

Sentryã¯ Next.js å‘ã‘ã®ã‚¬ã‚¤ãƒ‰ã‚„ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ï¼ˆWizard/Manualï¼‰ã‚’ç”¨æ„ã—ã¦ã‚‹ã‚ˆã€‚ ([docs.sentry.io][1])

---

## 2) ç›£è¦–ã§è¦‹ã‚‹ã¹ãã€Œ3ç‚¹ã‚»ãƒƒãƒˆã€ğŸ“Œâœ¨

ã‚¨ãƒ©ãƒ¼ç›£è¦–ã£ã¦è¨€ã†ã‘ã©ã€ã ã„ãŸã„ã“ã®3ã¤ãŒã‚»ãƒƒãƒˆã§è€ƒãˆã‚‹ã¨ãƒ©ã‚¯ã ã‚ˆã€œğŸ˜Š

1. **ã‚¨ãƒ©ãƒ¼ï¼ˆä¾‹å¤–ï¼‰**ï¼šè½ã¡ãŸï¼å£Šã‚ŒãŸï¼ğŸ§¨
2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**ï¼šé…ã„â€¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé›¢è„±â€¦ğŸ¢
3. **ãƒªãƒªãƒ¼ã‚¹/ç’°å¢ƒ**ï¼šproductionã ã‘è¦‹ãŸã„ã€previewã¯åˆ¥ã«ã—ãŸã„ğŸŒ±ğŸŒ³

Sentryã¯ã€Œã‚¨ãƒ©ãƒ¼ã€ã ã‘ã˜ã‚ƒãªãã€Œãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬ï¼ˆTracingï¼‰ã€ã‚‚ã§ãã‚‹ã‚ˆã€‚ ([docs.sentry.io][2])

---

## 3) å…¨ä½“åƒã‚’å›³ã§ã¤ã‹ã‚‚ã†ğŸ—ºï¸âœ¨ï¼ˆMermaidï¼‰

![Error Monitoring Flow](./picture/next_study_224_error_monitoring.png)

```mermaid
flowchart LR
  U["ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¶ğŸ“±"] -->|"ã‚¢ã‚¯ã‚»ã‚¹"| NX["Next.jsã‚¢ãƒ—ãƒªğŸ§©"]
  NX -->|"ä¾‹å¤–ç™ºç”ŸğŸ’¥"| EB["error.tsx / global-error.tsxğŸ§¯"]
  NX -->|"ã‚µãƒ¼ãƒãƒ¼å´ã®ä¾‹å¤–ğŸ’¥"| SV["Server/Route Handler/ActionğŸ§Š"]
  EB -->|"captureException"| SDK["Sentry SDKğŸ›°ï¸"]
  SV -->|"captureException / è‡ªå‹•åé›†"| SDK
  SDK -->|"ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡"| SEN["Sentryæœ¬ä½“ğŸ“¦"]
  SEN -->|"é€šçŸ¥ğŸ””"| DEV["ã‚ãªãŸï¼ˆé–‹ç™ºè€…ï¼‰ğŸ‘©â€ğŸ’»"]
  SEN -->|"èª²é¡ŒåŒ–ğŸ“"| ISSUE["Issueä¸€è¦§/ã‚¢ãƒ©ãƒ¼ãƒˆğŸ”¥"]
```

---

## 4) æœ€çŸ­ãƒ«ãƒ¼ãƒˆï¼šSentryã‚’â€œå°å…¥ã™ã‚‹ã ã‘â€ã‚„ã£ã¦ã¿ã‚ˆğŸš€ğŸ’–

### âœ… ã„ã¡ã°ã‚“ç°¡å˜ï¼šWizardï¼ˆãŠã™ã™ã‚ï¼‰

Sentryå…¬å¼ã¯ **Wizardã§ã®å°å…¥ãŒæœ€é€Ÿ**ã£ã¦æ¡ˆå†…ã—ã¦ã‚‹ã‚ˆã€‚ ([docs.sentry.io][1])

PowerShellï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ï¼‰ã§ğŸ‘‡

```bash
npx @sentry/wizard@latest -i nextjs
```

ã™ã‚‹ã¨ã€è³ªå•ã«ç­”ãˆãªãŒã‚‰è¨­å®šã—ã¦ãã‚Œã¦ã€ä¾‹ãˆã°ã“ã†ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œã‚‰ã‚ŒãŸã‚Šç·¨é›†ã•ã‚ŒãŸã‚Šã™ã‚‹ã‚ˆï¼ˆæ§‹æˆã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¬¡ç¬¬ï¼‰ï¼š

* `sentry.client.config.ts`ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶å´ã®åˆæœŸåŒ–ï¼‰
* `sentry.server.config.ts`ï¼ˆã‚µãƒ¼ãƒãƒ¼å´ã®åˆæœŸåŒ–ï¼‰
* `next.config.*` ã®Sentryè¨­å®š ãªã© ([docs.sentry.io][1])

---

## 5) App Routerã§â€œã¤ã¾ãšãã‚„ã™ã„â€ãƒã‚¤ãƒ³ãƒˆğŸª¤ğŸ˜µâ€ğŸ’«â†’ğŸ˜†

### âœ… ãƒã‚¤ãƒ³ãƒˆAï¼š`error.tsx` / `global-error.tsx` ã§ã€Œæ‹¾ã†ã€ğŸ§¯

App Routerã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯ã€Next.jsã®å…¬å¼ã§ã‚‚ `error.tsx` ç­‰ã§æ‰±ã†å½¢ãŒèª¬æ˜ã•ã‚Œã¦ã‚‹ã‚ˆã€‚ ([Next.js][3])

ã“ã“ã§ã€Œè¡¨ç¤ºã™ã‚‹ã ã‘ã€ã«ãªã£ã¡ã‚ƒã†ã¨ã€**Sentryã«é£›ã°ãªã„**ã“ã¨ãŒã‚ã‚‹ã‹ã‚‰ã€**æ˜ç¤ºçš„ã« `captureException`** ã™ã‚‹æµã‚ŒãŒã‚ˆãä½¿ã‚ã‚Œã‚‹ã‚ˆã€œï¼ˆApp Routerã§ã¯ç‰¹ã«è©±é¡Œã«ãªã‚Šã‚„ã™ã„ï¼‰ ([Zenn][4])

ä¾‹ï¼š`app/error.tsx`ï¼ˆé›°å›²æ°—ï¼‰

```tsx
"use client";

import { useEffect } from "react";
import * as Sentry from "@sentry/nextjs";

export default function Error({ error, reset }: { error: Error; reset: () => void }) {
  useEffect(() => {
    Sentry.captureException(error);
  }, [error]);

  return (
    <div style={{ padding: 16 }}>
      <h2>ã”ã‚ã‚“ã­ã€ã‚¨ãƒ©ãƒ¼ãŒèµ·ãã¡ã‚ƒã£ãŸğŸ¥²</h2>
      <button onClick={() => reset()}>ã‚‚ã†ä¸€å›ã‚„ã£ã¦ã¿ã‚‹ğŸ”</button>
    </div>
  );
}
```

### âœ… ãƒã‚¤ãƒ³ãƒˆBï¼šNext.jsã® â€œinstrumentation hookâ€ ã§åˆæœŸåŒ–ã™ã‚‹æµã‚Œã‚‚ã‚ã‚‹ğŸ§µ

Sentryã®Next.jsæ‰‹å‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§ã¯ã€**Next.js 15+ï¼ˆApp Router/Turbopackï¼‰**å‰æã®èª¬æ˜ãŒã‚ã‚‹ã‚ˆã€‚ ([docs.sentry.io][5])
ã¾ãŸã€Sentry SDKã®æµã‚Œã¨ã—ã¦ **instrumentation hookï¼ˆ`instrumentation.ts`ï¼‰å´ã¸å¯„ã›ã‚‹**è©±ã‚‚å‡ºã¦ãã‚‹ã“ã¨ãŒã‚ã‚‹ã‚ˆã€‚ ([GitHub][6])

> ã“ã“ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„æ§‹æˆã§å¤‰ã‚ã‚Šã‚„ã™ã„ã®ã§ã€Wizardã®ç”Ÿæˆç‰©ã‚’åŸºæœ¬ã«ã—ã¦ã€å¿…è¦ãªã¨ãã ã‘è§¦ã‚‹ã®ãŒå®‰å¿ƒğŸ˜Š

---

## 6) ã¡ã‚ƒã‚“ã¨å‹•ã„ã¦ã‚‹ã‹â€œæœ€é€Ÿãƒã‚§ãƒƒã‚¯â€ã—ã‚ˆâœ…ğŸ§ª

ã€Œå…¥ã‚ŒãŸã¤ã‚‚ã‚Šã€äº‹æ•…ã‚’é˜²ããŸã‚ã«ã€ãƒ†ã‚¹ãƒˆç”¨ã«ä¸€å›ã ã‘ã‚¨ãƒ©ãƒ¼å‡ºã™ã®ãŒãŠã™ã™ã‚ğŸ’¡

ãŸã¨ãˆã° `app/sentry-test/page.tsx` ã‚’ä½œã£ã¦â€¦

```tsx
export default function Page() {
  throw new Error("Sentry ãƒ†ã‚¹ãƒˆã ã‚ˆã€œğŸ’¥");
}
```

`/sentry-test` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€Sentryå´ã«ã‚¤ãƒ™ãƒ³ãƒˆãŒå±Šã‘ã°OKğŸ‰
å±Šã‹ãªã‹ã£ãŸã‚‰æ¬¡ã®ç« ï¼ˆãƒ­ã‚°ã®è¦‹æ–¹ï¼‰ã¨ã‚»ãƒƒãƒˆã§åŸå› è¿½ãˆã‚‹ã‚ˆğŸ§­âœ¨

---

## 7) æœ¬ç•ªã§è¶…é‡è¦ï¼šã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ï¼ˆSource Mapsï¼‰ğŸ—ºï¸ğŸ§µ

æœ¬ç•ªã§ã€Œã©ã®è¡Œã§è½ã¡ãŸã‹ã€ãŒåˆ†ã‹ã‚‹ã¨ã€ç›´ã™é€Ÿã•ãŒæ¿€å¤‰ã™ã‚‹ã‚ˆâš¡
Sentryã«ã¯ Next.jsã® **ã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—**ã«é–¢ã™ã‚‹èª¬æ˜ãŒã‚ã‚‹ã—ã€**Vercelé€£æºã§ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«è‡ªå‹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**ã™ã‚‹æ¡ˆå†…ã‚‚ã‚ã‚‹ã‚ˆã€‚ ([docs.sentry.io][7])

ãŸã ã—æ³¨æ„âš ï¸
â€œæœ¬ç•ªã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ—ã‚’å…¬é–‹ã—ã¡ã‚ƒã†è¨­å®šâ€ã¯ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒè¦‹ãˆã¡ã‚ƒã†ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ã®ã§æ‰±ã„ã¯æ…é‡ã«ã­â€¦ï¼ ([Vercel][8])

---

## 8) ç›£è¦–ã‚’ã€Œé€šçŸ¥ç–²ã‚Œã€ã•ã›ãªã„ã‚³ãƒ„ğŸ§˜â€â™€ï¸ğŸ”•â†’ğŸ””

ãŠã™ã™ã‚ã®è€ƒãˆæ–¹ã¯ã“ã‚ŒğŸ‘‡

* **ç’°å¢ƒã§åˆ†ã‘ã‚‹**ï¼šproductionã ã‘å¼·ã‚ã«é€šçŸ¥ğŸŒ³ / previewã¯å¼±ã‚ğŸŒ±
* **é‡è¦åº¦ã§åˆ†ã‘ã‚‹**ï¼š500ç³»ã¯å³é€šçŸ¥ğŸ”¥ã€ç‰¹å®šã®è»½ã„ã‚¨ãƒ©ãƒ¼ã¯ã¾ã¨ã‚ã‚‹ğŸ§º
* **åŒã˜ã‚¨ãƒ©ãƒ¼ã¯æŸã­ã‚‹**ï¼š1ä»¶ãšã¤æ¥ã‚‹ã¨åœ°ç„ğŸ˜µâ€ğŸ’«

---

## 9) ã‚ˆãã‚ã‚‹ãƒãƒã‚Šé›†ï¼ˆå…ˆã«å›é¿ã—ã‚ˆï¼‰ğŸª¤âœ¨

* **`try/catch` ã§æ¡ã‚Šã¤ã¶ã—ã¦ã‚‹**
  â†’ ç”»é¢ã¯å‹•ãã‘ã©ã€ç›£è¦–ã«ã¯ä½•ã‚‚æ¥ãªã„ğŸ˜‡ï¼ˆå¿…è¦ãªã‚‰ `captureException`ï¼‰
* **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé€ä¿¡ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹**ï¼ˆåºƒå‘Šãƒ–ãƒ­ãƒƒã‚«ãƒ¼ç­‰ï¼‰ğŸ§±
  â†’ ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚‚æ‹¾ãˆã‚‹è¨­è¨ˆã ã¨å®‰å¿ƒğŸ§Š
* **å€‹äººæƒ…å ±ã‚’é€ã‚‰ãªã„**
  â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’ãã®ã¾ã¾ã‚¤ãƒ™ãƒ³ãƒˆã«å…¥ã‚Œãªã„ï¼ˆãƒã‚¹ã‚¯/å‰Šé™¤ï¼‰ğŸ«¶

---

## 10) ãƒŸãƒ‹èª²é¡Œï¼ˆ10ã€œ15åˆ†ï¼‰ğŸ¯ğŸ’ªâœ¨

ã‚„ã‚‹ã“ã¨ã¯3ã¤ã ã‘ğŸ˜Š

1. `app/error.tsx` ã§ `captureException` ã‚’å…¥ã‚Œã‚‹ğŸ§¯
2. `/sentry-test` ã‚’ä½œã£ã¦ã‚ã–ã¨è½ã¨ã™ğŸ’¥
3. Sentryã«ã‚¤ãƒ™ãƒ³ãƒˆãŒå±Šã„ãŸã‚‰ã€

   * ã€Œã©ã®ãƒšãƒ¼ã‚¸ã‹ã€
   * ã€Œä½•å›èµ·ããŸã‹ã€
   * ã€Œproduction/previewã©ã£ã¡ã‹ã€
     ã‚’è¦‹ã¦ã¿ã‚‹ğŸ‘€âœ¨

ã§ããŸã‚‰ã‚‚ã†ã€**â€œå…¬é–‹ã—ã¦ã‚‚æ€–ããªã„â€é‹ç”¨ã®å…¥å£**ã«ç«‹ã£ã¦ã‚‹ã‚ˆã€œğŸ‰ğŸ§¡

[1]: https://docs.sentry.io/platforms/javascript/guides/nextjs/?utm_source=chatgpt.com "Sentry for Next.js"
[2]: https://docs.sentry.io/platforms/javascript/guides/nextjs/tracing/?utm_source=chatgpt.com "Set Up Tracing | Sentry for Next.js"
[3]: https://nextjs.org/docs/app/getting-started/error-handling?utm_source=chatgpt.com "Getting Started: Error Handling"
[4]: https://zenn.dev/gef/articles/1d416b1c810a30?utm_source=chatgpt.com "next app router ã« sentry ã‚’å°å…¥ã™ã‚‹"
[5]: https://docs.sentry.io/platforms/javascript/guides/nextjs/manual-setup/?utm_source=chatgpt.com "Manual Setup | Sentry for Next.js"
[6]: https://github.com/getsentry/sentry-javascript/issues/12044?utm_source=chatgpt.com "Next.js docs for v8.0.0 Â· Issue #12044 Â· getsentry/sentry- ..."
[7]: https://docs.sentry.io/platforms/javascript/guides/nextjs/sourcemaps/?utm_source=chatgpt.com "Source Maps | Sentry for Next.js"
[8]: https://vercel.com/docs/conformance/rules/NEXTJS_NO_PRODUCTION_SOURCE_MAPS?utm_source=chatgpt.com "NEXTJS_NO_PRODUCTION_S..."
