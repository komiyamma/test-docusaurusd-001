# ç¬¬87ç« ï¼šClientå´ã§å–ã‚‹ã®ã¯ã©ã‚“ãªæ™‚ï¼Ÿï¼ˆæ¤œç´¢/æ“ä½œUIï¼‰ğŸ®

ã“ã®ç« ã¯ã€Œ**ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè§¦ã£ãŸç¬é–“ã«å¤‰ã‚ã‚‹UI**ã€ã®ãŸã‚ã«ã€**ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆClientï¼‰ã§ãƒ‡ãƒ¼ã‚¿å–å¾—ã™ã‚‹ã®ãŒå‘ã„ã¦ã‚‹å ´é¢**ã‚’ã¤ã‹ã‚€å›ã ã‚ˆã€œğŸ˜ŠğŸ’¡

---

## ä»Šæ—¥ã®ã‚´ãƒ¼ãƒ«ğŸ¯

* ã€ŒServerã§å–ã‚‹ã¹ãï¼Ÿ Clientã§å–ã‚‹ã¹ãï¼Ÿã€ã‚’**ã‚µã‚¯ãƒƒã¨åˆ¤æ–­**ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ğŸ§ âœ¨
* **æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ»ãƒšãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆ**ã¿ãŸã„ãªâ€œæ“ä½œUIâ€ã®ã¨ãã«ã€Clientå–å¾—ãŒå¼·ã„ç†ç”±ã‚’ç†è§£ã™ã‚‹ğŸ”ğŸ®
* æœ€å°ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã€ŒClientå–å¾—ã®å‹ã€ã‚’ä½œã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ğŸ› ï¸ğŸŒ¸

---

## ã¾ãšçµè«–ï¼šClientã§å–ã‚‹ã®ãŒå¾—æ„ãªå ´é¢ğŸ†ğŸ®

ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ“ä½œã™ã‚‹ãŸã³ã«çµæœãŒå¤‰ã‚ã‚‹ã€ãªã‚‰ã€ClientãŒå‘ãã‚„ã™ã„ã‚ˆğŸ‘‡

* ğŸ” **æ¤œç´¢**ï¼ˆå…¥åŠ›ã™ã‚‹ãŸã³ã«çµæœãŒå¤‰ã‚ã‚‹ï¼‰
* ğŸšï¸ **çµã‚Šè¾¼ã¿ãƒ»ã‚½ãƒ¼ãƒˆ**ï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹/ã‚»ãƒ¬ã‚¯ãƒˆã§å¤‰ã‚ã‚‹ï¼‰
* ğŸ“„ **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³**ï¼ˆæ¬¡ã¸ãƒ»å‰ã¸ï¼‰
* â™¾ï¸ **ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«**ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§è¿½åŠ èª­ã¿è¾¼ã¿ï¼‰
* ğŸ” **å®šæœŸæ›´æ–°ï¼ˆãƒãƒ¼ãƒªãƒ³ã‚°ï¼‰**ï¼ˆæœ€æ–°ã‚³ãƒ¡ãƒ³ãƒˆ/é€šçŸ¥ãªã©ï¼‰
* ğŸ§© **éƒ¨åˆ†ã ã‘æ›´æ–°**ï¼ˆç”»é¢å…¨ä½“ã‚’ä½œã‚Šç›´ã™ã»ã©ã˜ã‚ƒãªã„ï¼‰
* ğŸ§‘â€ğŸ’» **ãƒ–ãƒ©ã‚¦ã‚¶ã ã‘ãŒæŒã¤æƒ…å ±ã‚’ä½¿ã†**ï¼ˆç”»é¢ã‚µã‚¤ã‚ºãƒ»ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ãªã©ï¼‰

---

## é€†ã«â€¦Clientã§å–ã‚‹ã®ãŒè‹¦æ‰‹ãªå ´é¢ğŸ˜µâ€ğŸ’«ğŸ’¦

* ğŸ—ï¸ **ç§˜å¯†æƒ…å ±ï¼ˆAPIã‚­ãƒ¼ç­‰ï¼‰ã‚’ä½¿ã†**å¿…è¦ãŒã‚ã‚‹
  â†’ Serverå´ã§å–ã‚‹ã®ãŒåŸºæœ¬ï¼ï¼ˆç§˜å¯†ãŒãƒ–ãƒ©ã‚¦ã‚¶ã«æ¼ã‚Œã¡ã‚ƒã†ï¼‰ ([Next.js][1])
* ğŸš€ **æœ€åˆã«è¡¨ç¤ºã—ãŸã„ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿**ï¼ˆSEO/åˆé€ŸãŒå¤§äº‹ï¼‰
  â†’ Server Componentsã§å–ã‚‹ã»ã†ãŒã€é€ã‚‹JSã‚‚æ¸›ã£ã¦é€Ÿããªã‚Šã‚„ã™ã„ã‚ˆ ([Next.js][1])
* ğŸ«§ **Suspenseã§â€œå¾…ã¡UIâ€ã‚’ç¶ºéº—ã«ã‚„ã‚ŠãŸã„**ï¼ˆâ€»æ³¨æ„ï¼‰
  `useEffect` ã®ä¸­ã§fetchã—ã¦ã‚‚ã€Suspenseã¯ãã‚Œã‚’å¾…ã£ã¦ãã‚Œãªã„ã® ğŸ¥ºï¼ˆåˆ¥ã®ã‚„ã‚Šæ–¹ãŒå¿…è¦ï¼‰ ([React][2])

---

## åˆ¤æ–­ãƒ•ãƒ­ãƒ¼ï¼ˆè¿·ã£ãŸã‚‰ã“ã‚Œï¼‰ğŸ—ºï¸âœ¨

![Client vs Serveråˆ¤æ–­ãƒ•ãƒ­ãƒ¼](./picture/next_study_087_client_vs_server.png)

```mermaid
flowchart TD
  A["ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ï¼"] --> B{"ç§˜å¯†æƒ…å ±(#quot;APIã‚­ãƒ¼ç­‰#quot;)ãŒå¿…è¦ï¼Ÿ"}
  B -->|"Yes"| S["Serverã§å–å¾—ãŒåŸºæœ¬ğŸ§Š"]
  B -->|"No"| C{"æœ€åˆã®è¡¨ç¤ºã«çµ¶å¯¾å¿…è¦ï¼Ÿ"}
  C -->|"Yes"| S2["Serverã§å–å¾—ãŒæœ‰åˆ©ğŸ§Š"]
  C -->|"No"| D{"ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã§é »ç¹ã«å¤‰ã‚ã‚‹ï¼Ÿ"}
  D -->|"Yes"| CL["Clientã§å–å¾—ãŒå‘ãğŸ®"]
  D -->|"No"| E{"å°‘é‡ã§ç«¯æœ«å†…ã ã‘ã§å®Œçµï¼Ÿ"}
  E -->|"Yes"| L["Clientã§ãƒ­ãƒ¼ã‚«ãƒ«å‡¦ç†ã§ã‚‚OKğŸ“±"]
  E -->|"No"| MIX["Serverã§åˆæœŸâ†’Clientã§æ“ä½œãŒæœ€å¼·ğŸ’ª"]
```

âœ¨ã„ã¡ã°ã‚“å¤šã„ã®ã¯æœ€å¾Œã® **ã€ŒServerã§åˆæœŸè¡¨ç¤º â†’ Clientã§æ¤œç´¢ã‚„çµã‚Šè¾¼ã¿ã€** ã ã‚ˆã€œï¼

---

## é‡è¦ãƒã‚¤ãƒ³ãƒˆï¼šClient Componentã¯ â€œasyncã§ç›´æ¥awaitâ€ã—ãªã„ğŸ™…â€â™€ï¸

Next.jsã§ã¯ **Client Componentã‚’ `async function` ã«ã—ãªã„**ã®ãŒåŸºæœ¬ã ã‚ˆï¼ˆæ³¨æ„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚ã‚ã‚‹ï¼‰
â†’ Clientã§å–ã‚‹ãªã‚‰ã€ã¾ãšã¯ `useEffect` ã‹ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆSWRãªã©ï¼‰ã§ã„ã“ã†ã­ğŸ˜Š ([Next.js][3])

---

## ãƒãƒ³ã‚ºã‚ªãƒ³ï¼šæ¤œç´¢UIï¼ˆClientã§å–å¾—ï¼‹çµã‚Šè¾¼ã¿ï¼‰ğŸ”ğŸ€

### ã‚„ã‚‹ã“ã¨ğŸŒŸ

* åˆå›ã«Clientã§ä¸€è¦§ã‚’å–å¾—ğŸ“¥
* å…¥åŠ›æ¬„ã§ã‚¿ã‚¤ãƒˆãƒ«æ¤œç´¢ã—ã¦çµã‚Šè¾¼ã¿ğŸ”
* ã¤ã„ã§ã«ã€Œèª­ã¿è¾¼ã¿ä¸­ã€ã‚‚è¡¨ç¤ºâ³

### 1) ãƒšãƒ¼ã‚¸ã‚’ä½œã‚‹ğŸ“„âœ¨ï¼ˆApp Routerï¼‰

`app/search/page.tsx` ã‚’ä½œã£ã¦ã­ï¼

```tsx
'use client';

import { useEffect, useMemo, useState } from 'react';
import { useDeferredValue } from 'react';

type Post = {
  id: number;
  title: string;
  body: string;
};

export default function SearchPage() {
  const [posts, setPosts] = useState<Post[]>([]);
  const [q, setQ] = useState('');
  const deferredQ = useDeferredValue(q); // å…¥åŠ›ã®å¼•ã£ã‹ã‹ã‚Šè»½æ¸›âœ¨
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const controller = new AbortController();

    (async () => {
      try {
        setLoading(true);
        setError(null);

        // å…¬é–‹ãƒ€ãƒŸãƒ¼APIï¼ˆå­¦ç¿’ç”¨ï¼‰âœ¨
        const res = await fetch('https://jsonplaceholder.typicode.com/posts', {
          signal: controller.signal,
        });
        if (!res.ok) throw new Error(`Fetch failed: ${res.status}`);

        const data: Post[] = await res.json();
        setPosts(data);
      } catch (e) {
        if (e instanceof DOMException && e.name === 'AbortError') return;
        setError(e instanceof Error ? e.message : 'Unknown error');
      } finally {
        setLoading(false);
      }
    })();

    return () => controller.abort();
  }, []);

  const filtered = useMemo(() => {
    const key = deferredQ.trim().toLowerCase();
    if (!key) return posts.slice(0, 20); // æœ€åˆã¯20ä»¶ã ã‘è¡¨ç¤º
    return posts
      .filter((p) => p.title.toLowerCase().includes(key))
      .slice(0, 20);
  }, [posts, deferredQ]);

  return (
    <main style={{ padding: 16, maxWidth: 720, margin: '0 auto' }}>
      <h1 style={{ fontSize: 24, fontWeight: 700 }}>è¨˜äº‹æ¤œç´¢ğŸ”âœ¨</h1>

      <label style={{ display: 'block', marginTop: 12 }}>
        ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ğŸ“
        <input
          value={q}
          onChange={(e) => setQ(e.target.value)}
          placeholder="ä¾‹ï¼šqui"
          style={{
            display: 'block',
            width: '100%',
            padding: 10,
            marginTop: 6,
            borderRadius: 10,
            border: '1px solid #ccc',
          }}
        />
      </label>

      {loading && <p style={{ marginTop: 12 }}>èª­ã¿è¾¼ã¿ä¸­ã ã‚ˆâ€¦â³</p>}
      {error && <p style={{ marginTop: 12 }}>ã‚¨ãƒ©ãƒ¼ã ã‚ˆâ€¦ğŸ¥º {error}</p>}

      {!loading && !error && (
        <>
          <p style={{ marginTop: 12 }}>
            è¡¨ç¤ºï¼š{filtered.length} ä»¶ï¼ˆæœ€å¤§20ä»¶ï¼‰ğŸ“šâœ¨
          </p>

          <ul style={{ marginTop: 8, paddingLeft: 18 }}>
            {filtered.map((p) => (
              <li key={p.id} style={{ marginBottom: 10 }}>
                <div style={{ fontWeight: 700 }}>{p.title}</div>
                <div style={{ opacity: 0.8, fontSize: 14 }}>{p.body}</div>
              </li>
            ))}
          </ul>
        </>
      )}
    </main>
  );
}
```

### 2) èµ·å‹•ã—ã¦è¦‹ã¦ã¿ã‚ˆã†ğŸš€ï¼ˆWindows / PowerShellï¼‰

```bash
npm run dev
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:3000/search` ã‚’é–‹ã„ã¦ã€å…¥åŠ›ã™ã‚‹ã¨çµã‚Šè¾¼ã¿ãŒå‹•ã‘ã°OKã ã‚ˆã€œğŸ‰ğŸ’•

---

## ã‚‚ã†ä¸€æ­©ï¼šClientã§å–ã‚‹ãªã‚‰ â€œSWRâ€ ãŒä¾¿åˆ©ğŸ§âœ¨

Clientå–å¾—ãŒå¢—ãˆã¦ãã‚‹ã¨ã€**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»å†å–å¾—ãƒ»ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¾©å¸°æ™‚ã®æ›´æ–°**ã¨ã‹ãŒé¢å€’ã«ãªã‚ŠãŒã¡â€¦ğŸ¥º
ãã“ã§Next.jså´ã‚‚ **SWRã‚’ãŠã™ã™ã‚**ã—ã¦ã‚‹ã‚ˆã€œï¼ ([Next.js][4])

ï¼ˆã“ã®ç« ã§ã¯é›°å›²æ°—ã ã‘ï¼ï¼‰ä¾‹ï¼š

```tsx
'use client';

import useSWR from 'swr';

const fetcher = (url: string) => fetch(url).then((r) => r.json());

export default function ProfileMini() {
  const { data, isLoading, error } = useSWR('/api/profile', fetcher);

  if (isLoading) return <p>èª­ã¿è¾¼ã¿ä¸­â€¦â³</p>;
  if (error) return <p>ã‚¨ãƒ©ãƒ¼â€¦ğŸ¥º</p>;

  return <p>ã“ã‚“ã«ã¡ã¯ã€{data.name} ã•ã‚“ğŸ˜Š</p>;
}
```

---

## ã‚ˆãã‚ã‚‹è½ã¨ã—ç©´ã¾ã¨ã‚ğŸª¤ğŸ˜³

* ğŸŒ€ å…¥åŠ›ã®ãŸã³ã«æ¯å›fetchã—ã¦ã—ã¾ã£ã¦é‡ã„
  â†’ **debounceï¼ˆå°‘ã—å¾…ã£ã¦ã‹ã‚‰å®Ÿè¡Œï¼‰**ã‚„ã€ã¾ãšã¯ã€Œä¸€æ‹¬å–å¾—â†’ãƒ­ãƒ¼ã‚«ãƒ«çµã‚Šè¾¼ã¿ã€ã‚‚ã‚¢ãƒªğŸ’¡
* ğŸ” APIã‚­ãƒ¼ã‚’Clientã«ç½®ã„ã¦ã—ã¾ã†
  â†’ **çµ¶å¯¾NGå¯„ã‚Š**ï¼Serverã¸ç§»å‹•ã—ã‚ˆã†ã­ ([Next.js][1])
* ğŸ«§ Suspenseã§å¾…ãŸã›ãŸã„ã®ã« `useEffect` ã§fetchã—ã¡ã‚ƒã†
  â†’ Suspenseã¯ãã‚Œã‚’å¾…ãŸãªã„ã‚ˆï¼ˆåˆ¥è¨­è¨ˆãŒå¿…è¦ï¼‰ ([React][2])

---

## ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆâœ…âœ¨ï¼ˆã“ã‚Œã ã‘è¦šãˆã‚Œã°å‹ã¡ï¼‰

* â˜‘ï¸ **æ“ä½œã§å¤‰ã‚ã‚‹ï¼ˆæ¤œç´¢/çµã‚Šè¾¼ã¿/ãƒšãƒ¼ã‚¸åˆ‡æ›¿ï¼‰** â†’ ClientãŒå‘ãğŸ®
* â˜‘ï¸ **æœ€åˆã«å‡ºã—ãŸã„ãƒ¡ã‚¤ãƒ³** â†’ ServerãŒå¼·ã„ğŸ§Š
* â˜‘ï¸ **ç§˜å¯†ãŒã„ã‚‹** â†’ Serverä¸€æŠã«è¿‘ã„ğŸ”
* â˜‘ï¸ Clientå–å¾—ãŒå¢—ãˆãŸã‚‰ **SWRç­‰ã‚’æ¤œè¨**ğŸ° ([Next.js][4])

---

ä»¥ä¸ŠãŒã€Œç¬¬87ç« ã€ã ã‚ˆã€œğŸ˜ŠğŸ€

[1]: https://nextjs.org/docs/app/getting-started/server-and-client-components?utm_source=chatgpt.com "Getting Started: Server and Client Components"
[2]: https://react.dev/reference/react/Suspense?utm_source=chatgpt.com "<Suspense> â€“ React"
[3]: https://nextjs.org/docs/messages/no-async-client-component?utm_source=chatgpt.com "No async Client Component"
[4]: https://nextjs.org/docs/pages/building-your-application/data-fetching/client-side?utm_source=chatgpt.com "Data Fetching: Client-side Fetching"
