# ç¬¬165ç« ï¼šãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®è€ƒãˆæ–¹ï¼ˆå±¥æ­´ãŒå‘½ï¼‰ğŸ§¾

## ã“ã®ç« ã§ã‚ã‹ã‚‹ã“ã¨ğŸ¯

* ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒã€ŒDBã®å¤‰æ›´å±¥æ­´ã€ã£ã¦ã©ã†ã„ã†æ„å‘³ã‹ğŸ“šâœ¨
* Prismaã§â€œå®‰å…¨ã«â€DBã®å½¢ã‚’è‚²ã¦ã¦ã„ãåŸºæœ¬ã®æµã‚ŒğŸŒ±
* é–‹ç™ºã¨æœ¬ç•ªã§ã‚³ãƒãƒ³ãƒ‰ãŒé•ã†ç†ç”±ï¼ˆã“ã“è¶…å¤§äº‹ï¼ï¼‰ğŸ›¡ï¸ğŸ”¥

---

## 1) ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã£ã¦ãªã«ï¼ŸğŸ§¾ğŸ’¡

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã²ã¨ã“ã¨ã§è¨€ã†ã¨â€¦

**ã€Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¨­è¨ˆå›³ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ï¼‰ã®å¤‰æ›´ã‚’ã€é †ç•ªã¤ãã§ä¿å­˜ã—ã¦ã„ãâ€œå±¥æ­´â€ã€**ã ã‚ˆã€œğŸ“œâœ¨

ãŸã¨ãˆã°ã€TODOã‚¢ãƒ—ãƒªã§â€¦

* æœ€åˆï¼š`title` ã ã‘ã‚ã‚Œã°OK ğŸ™†â€â™€ï¸
* å¾Œã‹ã‚‰ï¼š`dueDate`ï¼ˆæœŸé™ï¼‰ã‚‚æ¬²ã—ã„ï¼ğŸ“…
* ã•ã‚‰ã«ï¼š`done`ï¼ˆå®Œäº†ãƒ•ãƒ©ã‚°ï¼‰ã‚‚æ¬²ã—ã„ï¼âœ…

â€¦ã£ã¦æˆé•·ã™ã‚‹ã‚ˆã­ğŸŒ±
ã“ã®ã€Œæˆé•·ã®è¨˜éŒ²ã€ã‚’ã¡ã‚ƒã‚“ã¨æ®‹ã™ã®ãŒãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ğŸ§¾âœ¨

---

## 2) ãªã‚“ã§ã€Œå±¥æ­´ãŒå‘½ã€ãªã®ï¼ŸğŸ§ ğŸ”‘

DBã®å¤‰æ›´ã£ã¦ã€**æœ¬ç•ªã«ãƒ‡ãƒ¼ã‚¿ãŒå…¥ã£ãŸã‚ã¨**ãŒæ€–ã„ã®â€¦ğŸ˜±ğŸ’¦
ã€Œåˆ—ã‚’è¿½åŠ ã—ãŸã€ã€Œå‹ã‚’å¤‰ãˆãŸã€ã€Œå‰Šé™¤ã—ãŸã€ã£ã¦ã€å…¨éƒ¨ãƒ‡ãƒ¼ã‚¿ã«å½±éŸ¿ã™ã‚‹ã‹ã‚‰ã­ã€‚

ã ã‹ã‚‰å±¥æ­´ãŒã‚ã‚‹ã¨å¬‰ã—ã„ã“ã¨ãŒã„ã£ã±ã„ğŸ‘‡âœ¨

* âœ… ãƒãƒ¼ãƒ ã‚„åˆ¥PCã§ã‚‚ã€åŒã˜é †ç•ªã§åŒã˜DBæ§‹é€ ã«ã§ãã‚‹
* âœ… æœ¬ç•ªã§ã‚‚ã€Œæœªé©ç”¨ã®å·®åˆ†ã ã‘ã€ã‚’å®‰å…¨ã«å½“ã¦ã‚‰ã‚Œã‚‹
* âœ… ã„ã¤ãƒ»ä½•ã‚’å¤‰ãˆãŸã‹è¿½ãˆã‚‹ï¼ˆäº‹æ•…ã£ãŸæ™‚ã«åŠ©ã‹ã‚‹ï¼‰ğŸ§¯

Prismaã‚‚æœ¬ç•ªã§ã¯ **`migrate deploy` ã§â€œå±¥æ­´ï¼ˆmigrationsï¼‰ã‚’é †ç•ªã«é©ç”¨â€**ã™ã‚‹ã®ãŒæ¨å¥¨ã ã‚ˆã€œğŸ“¦ğŸš€ ([Prisma][1])

---

## 3) Prismaã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä½•ãŒæ®‹ã‚‹ã®ï¼ŸğŸ—‚ï¸âœ¨

Prismaã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹ã¨ã€ã–ã£ãã‚Šã“ã†ã„ã†ã®ãŒå¢—ãˆã‚‹ã‚ˆğŸ‘‡

* `prisma/schema.prisma`ï¼ˆè¨­è¨ˆå›³ï¼‰ğŸ“˜
* `prisma/migrations/**/migration.sql`ï¼ˆå¤‰æ›´æ‰‹é †ã®SQLï¼‰ğŸ§¾
* ãã—ã¦DBå´ã«ã¯ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®é©ç”¨çŠ¶æ³ã‚’è¨˜éŒ²ã™ã‚‹ä»•çµ„ã¿ãŒã‚ã‚‹ï¼ˆå±¥æ­´ç®¡ç†ï¼‰ğŸ§ âœ¨
  ï¼ˆPrismaã¯â€œé©ç”¨æ¸ˆã¿ã‹ã©ã†ã‹â€ã‚’è¦‹ãªãŒã‚‰é€²ã‚ã¦ãã‚Œã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã ã‚ˆã€œï¼‰

---

## 4) ã‚³ãƒãƒ³ãƒ‰ã®å½¹å‰²ã‚’æ•´ç†ã—ã‚ˆã£ğŸ§°âœ¨ï¼ˆã“ã“ãŒè¶…é‡è¦ğŸ¥¹ï¼‰

Prismaã¯ç’°å¢ƒã§ä½¿ã„åˆ†ã‘ã‚‹ã®ãŒåŸºæœ¬ï¼ğŸ‘‡

### âœ… é–‹ç™ºä¸­ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰

* `npx prisma migrate dev`

  * **å¤‰æ›´ã‹ã‚‰ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã£ã¦**
  * **ãƒ­ãƒ¼ã‚«ãƒ«DBã«é©ç”¨**ã—ã¦ãã‚Œã‚‹âœ¨
  * çŠ¶æ³ã«ã‚ˆã£ã¦ã¯ã€ŒDBãƒªã‚»ãƒƒãƒˆã—ãŸæ–¹ãŒã„ã„ï¼Ÿã€ã£ã¦èã„ã¦ãã‚‹ã“ã¨ãŒã‚ã‚‹ï¼ˆå±¥æ­´ãŒåˆã‚ãªã„æ™‚ãªã©ï¼‰ğŸ§¨ ([Prisma][2])

### âœ… æœ¬ç•ªãƒ»ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ï¼ˆé‹ç”¨ç’°å¢ƒï¼‰

* `npx prisma migrate deploy`

  * **`prisma/migrations` ã«ã‚ã‚‹â€œæœªé©ç”¨åˆ†ã ã‘â€ã‚’é †ç•ªã«é©ç”¨**ã™ã‚‹ğŸ’ª
  * æœ¬ç•ªã§ã¯ `migrate dev` ã˜ã‚ƒãªãã¦ `deploy` ãŒæ¨å¥¨ğŸ›¡ï¸ ([Prisma][1])

### âš ï¸ `db push` ã¯ï¼Ÿ

* `npx prisma db push` ã¯ **â€œãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ”ãƒ³ã‚°å‘ãâ€**ï¼ˆå±¥æ­´ã‚’ä½œã‚‰ãªã„/å®ˆã‚ŠãŒå¼±ã„ï¼‰ã‚¿ã‚¤ãƒ—
* æœ¬ç•ªé‹ç”¨ã®åŸºæœ¬ã¯ **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é‹ç”¨ï¼ˆå±¥æ­´ã‚ã‚Šï¼‰**ã ã‚ˆã€œğŸ“Œ ([Prisma][3])

---

## 5) ã„ã¡ã°ã‚“æ¨™æº–ã®æµã‚Œï¼ˆå›³ã§è¦šãˆã‚‹ï¼‰ğŸ§ â¡ï¸ğŸš€

![Migration History](./picture/next_study_165_migration_history.png)

```mermaid
flowchart LR
  A["schema.prisma ã‚’å¤‰æ›´ã™ã‚‹ğŸ“˜"] --> B["migrate dev ã§ migration ã‚’ä½œã‚‹ğŸ§¾"]
  B --> C["ãƒ­ãƒ¼ã‚«ãƒ«DBã«é©ç”¨ã—ã¦å‹•ä½œç¢ºèªâœ…"]
  C --> D["prisma/migrations ã¨ schema.prisma ã‚’Gitã«ã‚³ãƒŸãƒƒãƒˆğŸ“¦"]
  D --> E["æœ¬ç•ªã¸ãƒ‡ãƒ—ãƒ­ã‚¤ğŸš€"]
  E --> F["migrate deploy ã§æœªé©ç”¨migrationã‚’é©ç”¨ğŸ›¡ï¸"]
```

ã“ã®ã€Œ**ä½œã‚‹â†’è©¦ã™â†’ã‚³ãƒŸãƒƒãƒˆâ†’æœ¬ç•ªã§é©ç”¨**ã€ãŒç‹é“ã ã‚ˆã€œğŸ‘‘âœ¨ ([GitHub][4])

---

## 6) ãƒŸãƒ‹å®Ÿè·µï¼šTodoã« `dueDate` ã‚’è¿½åŠ ã™ã‚‹æƒ³å®šğŸ“…â•âœ¨

ã“ã“ã§ã¯ã€Œé›°å›²æ°—ã€ã‚’æ´ã‚€ã ã‘ã§OKã ã‚ˆâ˜ºï¸ğŸŒ¸
ï¼ˆPowerShellã§ã‚‚OKï¼ï¼‰

### æ‰‹é †ğŸŒŸ

1. `prisma/schema.prisma` ã® `Todo` ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¶³ã™
   ä¾‹ï¼š`dueDate DateTime?`

2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆï¼†é©ç”¨ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰

```bash
npx prisma migrate dev --name add_todo_due_date
```

3. ç”Ÿæˆç‰©ã‚’ç¢ºèªğŸ‘€âœ¨

* `prisma/migrations/....../migration.sql` ãŒã§ãã¦ã‚‹ã¯ãšğŸ§¾
* ã€Œã©ã‚“ãªSQLãŒå½“ãŸã‚‹ã®ã‹ã€ãŒè¦‹ãˆã‚‹ã®ã€å®‰å¿ƒã ã‚ˆã­ã€œğŸ«¶

4. ã‚¢ãƒ—ãƒªã‚’å‹•ã‹ã—ã¦ç¢ºèªâœ…ğŸ‰
   ï¼ˆãƒ•ã‚©ãƒ¼ãƒ ã‚„ä¸€è¦§è¡¨ç¤ºã¯æ¬¡ã®ç« ã§ã©ã‚“ã©ã‚“è‚²ã¦ã‚Œã°OKï¼ğŸŒ±ï¼‰

---

## 7) ã‚ˆãã‚ã‚‹äº‹æ•…ãƒã‚¤ãƒ³ãƒˆï¼ˆå…ˆã«å›é¿ã—ã‚ˆğŸ¥¹ğŸ§¯ï¼‰

### âŒ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ã¨ã‹ã‚‰é›‘ã«æ›¸ãæ›ãˆã‚‹

å±¥æ­´ã®æ•´åˆãŒå£Šã‚Œã¦ã€`migrate dev` ãŒã€Œãƒªã‚»ãƒƒãƒˆã—ã‚ˆï¼Ÿã€ã£ã¦è¨€ã„ãŒã¡âš ï¸ ([Prisma][5])

### âŒ æœ¬ç•ªã§ `migrate dev` ã‚’ä½¿ã†

æœ¬ç•ªã¯åŸºæœ¬ `migrate deploy`ï¼ğŸ›¡ï¸ï¼ˆé‹ç”¨ã®ãŸã‚ã®ã‚³ãƒãƒ³ãƒ‰ï¼‰ ([GitHub][4])

### âŒ ã™ã§ã«ãƒ†ãƒ¼ãƒ–ãƒ«ãŒã‚ã‚‹æœ¬ç•ªDBã«ã€ã„ããªã‚Šdeployã—ãŸã‚‰æ€’ã‚‰ã‚ŒãŸ

ã€ŒDBãŒç©ºã˜ã‚ƒãªã„ã‚ˆï¼ã€ã¿ãŸã„ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã“ã¨ãŒã‚ã‚‹ğŸ¥²
ãã®å ´åˆã¯ **baselineï¼ˆæ—¢å­˜DBã‚’â€œåˆæœŸçŠ¶æ…‹ã¨ã—ã¦è¨˜éŒ²ã™ã‚‹â€ï¼‰**ã®è€ƒãˆæ–¹ãŒå¿…è¦ã«ãªã‚‹ã‚ˆã€œğŸ“Œ ([GitHub][4])

---

## ã¾ã¨ã‚ğŸ€âœ¨

* ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼**DBå¤‰æ›´ã®â€œå±¥æ­´â€**ã§ã€ã“ã‚ŒãŒã‚ã‚‹ã¨é‹ç”¨ãŒå®‰å…¨ğŸ§¾ğŸ›¡ï¸
* é–‹ç™ºã¯ `migrate dev`ã€æœ¬ç•ªã¯ `migrate deploy` ãŒåŸºæœ¬ã‚»ãƒƒãƒˆğŸš€ ([GitHub][4])
* `db push` ã¯ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ”ãƒ³ã‚°å‘ãã§ã€é‹ç”¨ã§ã¯å±¥æ­´ã‚’æ®‹ã™æ–¹ãŒå¼·ã„ğŸ“Œ ([Prisma][3])

æ¬¡ã®ç« ã‹ã‚‰ã€ã„ã‚ˆã„ã‚ˆã€Œã©ã“ã§DBã«ã¤ãªãï¼Ÿã€ã¿ãŸã„ãªå®Ÿè£…ã®ç½®ãå ´æ‰€ã«å…¥ã£ã¦ã„ãã‚ˆã€œğŸ§ŠğŸ”Œâœ¨

[1]: https://www.prisma.io/docs/orm/prisma-client/deployment/deploy-database-changes-with-prisma-migrate?utm_source=chatgpt.com "Deploying database changes with Prisma Migrate"
[2]: https://www.prisma.io/docs/orm/prisma-migrate/workflows/development-and-production?utm_source=chatgpt.com "Development and production | Prisma Documentation"
[3]: https://www.prisma.io/docs/orm/prisma-migrate/workflows/prototyping-your-schema?utm_source=chatgpt.com "Prototyping your schema | Prisma Documentation"
[4]: https://github.com/prisma/prisma/discussions/24571 "How should migration be done to Production? Â· prisma prisma Â· Discussion #24571 Â· GitHub"
[5]: https://www.prisma.io/docs/orm/prisma-migrate/understanding-prisma-migrate/migration-histories?utm_source=chatgpt.com "About migration histories | Prisma Documentation"
