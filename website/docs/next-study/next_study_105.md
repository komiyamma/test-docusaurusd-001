# ç¬¬105ç« ï¼šRoute Handlerã£ã¦ãªã«ï¼Ÿï¼ˆã‚¢ãƒ—ãƒªå†…APIï¼‰ğŸ§ª

ã“ã®ç« ã§ã¯ã€ŒNext.jsã®ä¸­ã«APIã‚’ä½œã‚‹ã€ï¼ **Route Handler** ã‚’ã€è¶…ã‚„ã•ã—ãã¤ã‹ã¿ã¾ã™â˜ºï¸âœ¨
ï¼ˆæ¬¡ã®ç« ã§å®Ÿéš›ã« `app/api/xxx/route.ts` ã‚’ä½œã‚‹ã®ã§ã€ä»Šæ—¥ã¯â€œæ­£ä½“â€ã‚’çŸ¥ã‚‹å›ã ã‚ˆã€œï¼ğŸ€ï¼‰

---

## 1) Route Handlerã£ã¦ä¸€è¨€ã§ã„ã†ã¨ï¼ŸğŸ§ ğŸ’¡

**ã€ŒNext.jsã‚¢ãƒ—ãƒªã®ä¸­ã«ä½œã‚Œã‚‹ã€ãƒŸãƒ‹APIï¼ˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰ã€** ã§ã™ğŸšªâœ¨
ãŸã¨ãˆã° `/api/hello` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚‰ã€JSONã‚’è¿”ã™â€¦ã¿ãŸã„ãªã“ã¨ãŒã§ãã¾ã™ğŸ“¦

Next.jså…¬å¼ã§ã‚‚ã€ŒRoute Handlersã¯ `app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸­ã§ä½¿ãˆã¦ã€Webæ¨™æº–ã® Request/Response ã§æ›¸ã‘ã‚‹ã‚ˆã€ã¨èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ğŸ“˜
([Next.js][1])

---

## 2) ä½•ãŒã†ã‚Œã—ã„ã®ï¼Ÿï¼ˆä½¿ã†ç†ç”±ï¼‰ğŸ˜ğŸ

Route HandlerãŒã‚ã‚‹ã¨ã€ã“ã†ã„ã†ã®ãŒãƒ©ã‚¯ã«ãªã‚Šã¾ã™ğŸ‘‡âœ¨

* **APIã‚­ãƒ¼ã‚’éš ã—ãŸã„**ğŸ”ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã«è¦‹ã›ãŸããªã„ï¼ï¼‰
* **å¤–éƒ¨APIã®çµæœã‚’æ•´å½¢ã—ã¦è¿”ã—ãŸã„**ğŸ§¹ï¼ˆå¿…è¦ãªå½¢ã«ã—ã¦æ¸¡ã™ï¼‰
* **èªè¨¼ãƒã‚§ãƒƒã‚¯ã‚’æŒŸã¿ãŸã„**ğŸ§¤ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚‹äººã ã‘OKãªã©ï¼‰
* **ãƒ•ãƒ­ãƒ³ãƒˆï¼ˆç”»é¢ï¼‰ã‹ã‚‰å©ã‘ã‚‹â€œè‡ªåˆ†ã®APIâ€ãŒæ¬²ã—ã„**ğŸ¯

ã¤ã¾ã‚Šã€Next.jsãŒ **UIã ã‘ã˜ã‚ƒãªãâ€œã¡ã‚‡ã„ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å½¹â€ã‚‚ã§ãã‚‹**æ„Ÿã˜ã ã‚ˆã€œğŸ«¶âœ¨
ï¼ˆå®Ÿå‹™ã ã¨BFFã£ã¦å‘¼ã°ã‚ŒãŸã‚Šã‚‚ã—ã¾ã™ğŸ“¡ï¼‰([CLYR][2])

---

## 3) ã©ã“ã«ç½®ãã®ï¼Ÿã©ã‚“ãªURLã«ãªã‚‹ã®ï¼ŸğŸ—‚ï¸â¡ï¸ğŸŒ

Route Handlerã¯ `app` ã®ä¸­ã§ã€**`route.ts`ï¼ˆã¾ãŸã¯ `route.js`ï¼‰** ã¨ã„ã†ç‰¹åˆ¥ãªãƒ•ã‚¡ã‚¤ãƒ«åã§ä½œã‚Šã¾ã™ğŸ“Œ
ãŸã¨ãˆã°ï¼š

* `app/api/hello/route.ts` â†’ URLã¯ **`/api/hello`**

ã“ã†ã„ã†â€œãƒ•ã‚¡ã‚¤ãƒ«ã¨URLãŒç›´çµâ€ã™ã‚‹ã®ãŒã€Next.jsã‚‰ã—ã•ã ã­â˜ºï¸
([Next.js][1])

---

## 4) ã–ã£ãã‚Šå…¨ä½“ã®æµã‚Œï¼ˆå›³ï¼‰ğŸ—ºï¸âœ¨

![ã–ã£ãã‚Šå…¨ä½“ã®æµã‚Œ](./picture/next_study_105_route_handler_intro.png)

ã€Œãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆã¾ãŸã¯ã‚¢ãƒ—ãƒªï¼‰ã‹ã‚‰ /api/xxx ã‚’å©ãã€â†’ã€Œroute.tsãŒè¿”ã™ã€ã£ã¦æµã‚Œã§ã™ğŸ“¨

```mermaid
flowchart LR
  A["Browser / Frontend"] --> B["/api/hello ã«ã‚¢ã‚¯ã‚»ã‚¹"]
  B --> C["app/api/hello/route.ts"]
  C --> D["Response(JSON / Text)"]
  D --> A
```

---

## 5) Route Handlerã®ä¸­èº«ã¯ä½•ã‚’æ›¸ãã®ï¼ŸğŸ§©

ãƒã‚¤ãƒ³ãƒˆã¯ã“ã‚Œã ã‘è¦šãˆã‚Œã°OKã§ã™ğŸ™†â€â™€ï¸âœ¨

* **HTTPãƒ¡ã‚½ãƒƒãƒ‰åã®é–¢æ•°**ã‚’ `export` ã™ã‚‹ï¼ˆGET/POST/PUTâ€¦ãªã©ï¼‰
* **è¿”ã™ã®ã¯ Response**ï¼ˆã¾ãŸã¯ NextResponseï¼‰ğŸ“¦
* **Request/Response ã¯Webæ¨™æº–**ã®å½¢ğŸ§ 
  ([Next.js][1])

ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆæœ€å°ï¼‰ğŸ‘‡

```ts
// app/api/hello/route.ts
export async function GET() {
  return Response.json({ message: "Hello!" });
}
```

ï¼ˆ`Response.json()` ãŒä½¿ãˆãªã„ç’°å¢ƒã®ã¨ãã¯ `NextResponse.json()` ã‚’ä½¿ã†ã“ã¨ã‚‚å¤šã„ã‚ˆã€œğŸ“Œï¼‰
([Sogo.dev][3])

---

## 6) ã„ã¤Route Handlerã‚’ä½¿ã£ã¦ã€ã„ã¤ä½¿ã‚ãªã„ï¼ŸğŸ¤”âš–ï¸

### ä½¿ã†ã¨æ°—æŒã¡ã„ã„å ´é¢ğŸ’–

* ç”»é¢ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã‹ã‚‰ `fetch('/api/...')` ã§å‘¼ã³ãŸã„ğŸ®
* å¤–éƒ¨APIã®ã‚­ãƒ¼ã‚’éš ã—ãŸã„ğŸ”
* â€œã¡ã‚‡ã„ã‚µãƒ¼ãƒãƒ¼å‡¦ç†â€ã‚’æŒŸã¿ãŸã„ï¼ˆèªè¨¼/æ•´å½¢/ãƒ­ã‚°ï¼‰ğŸ§¤ğŸ§¼ğŸ“

### ä½¿ã‚ãªãã¦ã‚‚ã„ã„å ´é¢ğŸŒ¿

* **Server Componentsã ã‘ã§å®Œçµ**ã§ãã‚‹ï¼ˆç”»é¢ã‚’ä½œã‚‹ã ã‘ï¼‰ğŸµ
  â†’ ã‚µãƒ¼ãƒãƒ¼å´ã§ `fetch` ã—ã¦æç”»ã—ã¡ã‚ƒãˆã°OKãªã“ã¨ã‚‚å¤šã„ã§ã™âœ¨

ï¼ˆæ¬¡ã®ç« ä»¥é™ã§ã€Œä½¿ã„åˆ†ã‘ã®ã‚³ãƒ„ã€ãŒã‚‚ã£ã¨ã‚¯ãƒªã‚¢ã«ãªã‚Šã¾ã™ğŸ˜‰ï¼‰

---

## 7) å®Ÿè¡Œç’°å¢ƒï¼ˆRuntimeï¼‰ã£ã¦ãªã«ï¼ŸğŸ§ âš¡

Route Handlerã¯ã‚µãƒ¼ãƒãƒ¼ã§å‹•ãã¾ã™ã€‚Next.jsã«ã¯ä¸»ã« **Node.js Runtimeï¼ˆé€šå¸¸ï¼‰** ã¨ **Edge Runtimeï¼ˆåˆ¶ç´„ã‚ã‚Šã ã‘ã©é€Ÿã„ç³»ï¼‰** ãŒã‚ã‚Šã€ãƒ«ãƒ¼ãƒˆã”ã¨ã«æŒ‡å®šã§ãã¾ã™ğŸ§­

```ts
export const runtime = "edge"; // ã¾ãŸã¯ "nodejs"
```

ã“ã®æŒ‡å®šã®è€ƒãˆæ–¹ã¯å…¬å¼ã«ã¾ã¨ã¾ã£ã¦ã¾ã™ğŸ“˜
([Next.js][4])

Edgeã¯ **Node.jsã®æ©Ÿèƒ½ãŒå…¨éƒ¨ä½¿ãˆã‚‹ã‚ã‘ã˜ã‚ƒãªã„** ã®ã§ã€æ…£ã‚Œã‚‹ã¾ã§ã¯åŸºæœ¬ nodejs ã®ã¾ã¾ã§OKã§ã™â˜ºï¸
([Next.js][5])

---

## 8) ã‚ˆãã‚ã‚‹ã€Œã¤ã¾ãšãã€ã‚ã‚‹ã‚ã‚‹ğŸª¤ğŸ˜µâ€ğŸ’«

* `route.ts` ã®åå‰ã‚’é–“é•ãˆã‚‹ï¼ˆ`routes.ts` ã¨ã‹ï¼‰ğŸ˜‡
* `app/api/...` ã®å ´æ‰€ã˜ã‚ƒãªã„ã¨ã“ã‚ã«ç½®ãğŸ¥²
* `export async function GET()` ã‚’æ›¸ãå¿˜ã‚Œã‚‹ğŸ˜µ
* è¿”ã‚Šå€¤ãŒ `Response` ã˜ã‚ƒãªã„ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãã®ã¾ã¾è¿”ã—ã¦ã—ã¾ã†ï¼‰ğŸ™…â€â™€ï¸
* Edgeã«ã—ã¦ã‚‹ã®ã« Node.js ã®æ©Ÿèƒ½ã‚’ä½¿ã£ã¦è½ã¡ã‚‹âš¡ğŸ’¥
  ([Next.js][5])

---

## 9) ãƒŸãƒ‹ã‚´ãƒ¼ãƒ«ï¼ˆä»Šæ—¥ã®é”æˆãƒ©ã‚¤ãƒ³ï¼‰ğŸâœ¨

ä»Šæ—¥ã¯ã“ã‚ŒãŒè¨€ãˆãŸã‚‰å‹ã¡ã§ã™ğŸ˜†ğŸ’•

* Route Handlerã¯ **Next.jså†…ã§ä½œã‚Œã‚‹API**ğŸ§ª
* ç½®ãå ´æ‰€ã¯ **`app/api/**/route.ts`**ğŸ—‚ï¸
* **HTTPãƒ¡ã‚½ãƒƒãƒ‰é–¢æ•°ï¼ˆGET/POSTâ€¦ï¼‰ã‚’export**ã™ã‚‹ğŸ“¤
* **Responseï¼ˆWebæ¨™æº–ï¼‰ã‚’è¿”ã™**ğŸ“¦
  ([Next.js][1])

---

## 10) æ¬¡ã®ç« ã®äºˆå‘ŠğŸ¬âœ¨

æ¬¡ã¯å®Ÿéš›ã«ä½œã‚Šã¾ã™ï¼ğŸ‰
`app/api/xxx/route.ts` ã‚’ä½œã£ã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:3000/api/xxx` ã‚’é–‹ã„ã¦ **JSONãŒè¿”ã£ã¦ãã‚‹æ„Ÿå‹•**ã‚’ã‚„ã‚ã†ã­ğŸ˜†ğŸ“¦âœ¨

æº–å‚™ã§ããŸã‚‰ã€ç¬¬106ç« ã„ã“ã€œï¼ğŸš€ğŸ’•

[1]: https://nextjs.org/docs/app/getting-started/route-handlers?utm_source=chatgpt.com "Getting Started: Route Handlers"
[2]: https://www.clyr.co.jp/posts/build-bff-with-nextjs-route-handlers-2828?utm_source=chatgpt.com "Next.js Route Handlerså®Ÿè£…ã§BFFãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•"
[3]: https://sogo.dev/posts/2025/03/nextjs-dont-use-singleton-response?utm_source=chatgpt.com "Next.jsã§NextResponseã‚’ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã—ã¦ã¯ ..."
[4]: https://nextjs.org/docs/14/app/building-your-application/rendering/edge-and-nodejs-runtimes?utm_source=chatgpt.com "Rendering: Edge and Node.js Runtimes"
[5]: https://nextjs.org/docs/messages/node-module-in-edge-runtime?utm_source=chatgpt.com "Using Node.js Modules in Edge Runtime"
