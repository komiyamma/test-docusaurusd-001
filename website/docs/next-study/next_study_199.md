# ç¬¬199ç« ï¼šCore Web Vitals ã–ã£ãã‚Šï¼ˆæ°—ã«ã—ã™ããªã„ï¼‰ğŸ«¶

ã“ã®ç« ã®ã‚´ãƒ¼ãƒ«ã¯ã€ŒCore Web Vitalsï¼ˆCWVï¼‰ã£ã¦çµå±€ãªã«ï¼Ÿã€ã€Œã©ã“ã¾ã§æ°—ã«ã™ã‚Œã°ã„ã„ï¼Ÿã€ã‚’ã€ãµã‚ã£ã¨æ´ã‚€ã“ã¨ã ã‚ˆã€œğŸ˜Šâœ¨
çµè«–ï¼š**â€œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå›°ã£ã¦ãªã„ãªã‚‰ã€ç¥çµŒè³ªã«ãªã‚Šã™ããªãã¦OKâ€** ã ã‚ˆğŸ™†â€â™€ï¸ğŸŒ¸

---

## 1) Core Web Vitals ã£ã¦ãªã«ï¼ŸğŸ€

![Core Web Vitals](./picture/next_study_199_cwv_pillars.png)

Core Web Vitals ã¯ã€Webã®ä½“é¨“ã‚’ã–ã£ãã‚Š3ã¤ã§è¦‹ã‚‹æŒ‡æ¨™ã ã‚ˆğŸ“âœ¨ï¼ˆä»Šã¯ **LCP / INP / CLS** ã®3ã¤ï¼‰ ([Google for Developers][1])

```mermaid
flowchart TD
  UX["ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ğŸ˜Š"] --> LCP["LCP: è¡¨ç¤ºã®é€Ÿã•ğŸƒâ€â™€ï¸"]
  UX --> INP["INP: æ“ä½œã®åå¿œğŸ–±ï¸"]
  UX --> CLS["CLS: ã‚¬ã‚¿ã‚¬ã‚¿ã—ãªã„ğŸ“"]

  LCP --> C1["ä¸»ã«ç”»åƒ/ãƒ•ã‚©ãƒ³ãƒˆ/ã‚µãƒ¼ãƒãƒ¼å¿œç­”ğŸ–¼ï¸ğŸ”¤âš¡"]
  INP --> C2["ä¸»ã«JSã®é‡ã•/é•·ã„å‡¦ç†ğŸ˜ğŸ§ "]
  CLS --> C3["ä¸»ã«ã‚µã‚¤ã‚ºæœªæŒ‡å®š/å¾Œå‡ºã—UIğŸ“¦â†•ï¸"]
```

---

## 2) ç›®æ¨™ãƒ©ã‚¤ãƒ³ï¼ˆâ€œGoodâ€ï¼‰ã ã‘è¦šãˆã‚ˆã£ã‹âœ…âœ¨

ã¾ãšã¯ã€Œè‰¯ã„ã€ãƒ©ã‚¤ãƒ³ã ã‘æš—è¨˜ã§OKã€œï¼ğŸ˜†ğŸ§ 
ï¼ˆCWVã¯ **75ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«** ã§åˆ¤å®šã™ã‚‹ã‚ˆã€ã£ã¦ã®ã‚‚ãµã‚“ã‚ã‚Šè¦šãˆã¦ãŠãã¨â—ï¼‰ ([Google for Developers][1])

* **LCPï¼ˆè¡¨ç¤ºã®é€Ÿã•ï¼‰**ï¼š**2.5ç§’ä»¥å†…** ãŒGood ğŸƒâ€â™€ï¸ğŸ’¨
* **INPï¼ˆæ“ä½œã®åå¿œï¼‰**ï¼š**200msæœªæº€** ãŒGood ğŸ–±ï¸âœ¨
* **CLSï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®å®‰å®šï¼‰**ï¼š**0.1æœªæº€** ãŒGood ğŸ“âœ¨ ([Google for Developers][2])

ã¤ã„ã§ã«ã€Œã“ã‚Œã¯ãƒ¤ãƒã„â€¦ã€ã®ãƒ©ã‚¤ãƒ³ã‚‚ä¸€å¿œğŸ‘‡

* LCPï¼š**4ç§’è¶…** ã¯Poor
* INPï¼š**500msè¶…** ã¯Poor
* CLSï¼š**0.25è¶…** ã¯Poor ([web.dev][3])

---

## 3) ã€Œæ°—ã«ã—ã™ããªã„ã€ã£ã¦ã©ã†ã„ã†ã“ã¨ï¼ŸğŸ«¶ğŸŒ™

CWVã£ã¦ã€**ãƒ†ã‚¹ãƒˆã®ç‚¹æ•°ã§æº€ç‚¹ã‚’ç›®æŒ‡ã™ã‚²ãƒ¼ãƒ **ã˜ã‚ƒãªãã¦ã€
**â€œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¹ãƒˆãƒ¬ã‚¹æ„Ÿã˜ã¦ãªã„ï¼Ÿâ€ã®å¥åº·è¨ºæ–­**ã¿ãŸã„ãªã‚‚ã®ã ã‚ˆã€œğŸ¥ğŸ’•

ã ã‹ã‚‰ãŠã™ã™ã‚ã®æ¸©åº¦æ„Ÿã¯ã“ã‚ŒğŸ‘‡

* Lighthouse ãŒ 100 ç‚¹ã˜ã‚ƒãªãã¦ã‚‚å¤§ä¸ˆå¤«ğŸ™†â€â™€ï¸ï¼ˆç›®å®‰ã®1ã¤ï¼ï¼‰
* ã¾ãšã¯ **Poorï¼ˆèµ¤ï¼‰ã ã‘æ½°ã›ã°å‹ã¡** ğŸ”¥â¡ï¸âœ…
* ä½“æ„Ÿã§ã€Œé…ã£â€¦ğŸ˜«ã€ã¨ã‹ã€ŒæŠ¼ã›ãªã„ğŸ˜¡ã€ãŒæ¶ˆãˆãŸã‚‰ã€ã‚‚ã†ååˆ†ãˆã‚‰ã„ğŸ‘âœ¨
* CWV ã¯ **å®Ÿãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿**ï¼ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰ã‚‚å¤§äº‹ã€‚ãƒ©ãƒœçµæœã¨ã‚ºãƒ¬ã‚‹ã®ã¯æ™®é€šã ã‚ˆã€œğŸŒ ([Google for Developers][1])

---

## 4) ã©ã“ã§è¦‹ã‚Œã°ã„ã„ã®ï¼Ÿï¼ˆ3ã¤ã ã‘ï¼‰ğŸ‘€âœ¨

```mermaid
flowchart LR
  Lab["ãƒ©ãƒœè¨ˆæ¸¬ğŸ§ª<br>Lighthouseãªã©"] --> Hint["æ”¹å–„ã®ãƒ’ãƒ³ãƒˆğŸ”"]
  Field["å®Ÿãƒ¦ãƒ¼ã‚¶ãƒ¼è¨ˆæ¸¬ğŸŒ<br>Search Console/CrUX/PSI"] --> Judge["åˆå¦ã®åˆ¤æ–­âœ…"]
  Hint --> Fix["ç›´ã™âœï¸"]
  Fix --> Deploy["ãƒ‡ãƒ—ãƒ­ã‚¤ğŸš€"]
  Deploy --> Field
```

### âœ… (1) Chrome DevTools â†’ Lighthouse ğŸ§ª

é–‹ç™ºä¸­ã«ã€Œã©ã“ãŒé‡ã„ï¼Ÿã€ã®å½“ãŸã‚Šã‚’ã¤ã‘ã‚‹ã®ã«ä¾¿åˆ©âœ¨

### âœ… (2) PageSpeed Insightsï¼ˆPSIï¼‰ğŸ“Š

**ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå®Ÿãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰** ã¨ **ãƒ©ãƒœ** ã‚’ä¸€ç·’ã«è¦‹ã‚„ã™ã„ï¼
CWV ã®æ‰±ã„ï¼ˆINP/LCP/CLSã€75ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«åˆ¤å®šï¼‰ã‚‚ã“ã“ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã‚ˆğŸ«¶ ([Google for Developers][1])

### âœ… (3) Search Console ã® Core Web Vitals ãƒ¬ãƒãƒ¼ãƒˆğŸ”

ã‚µã‚¤ãƒˆé‹ç”¨ã—ã¦ã‚‹ãªã‚‰ã“ã“ãŒæœ¬ä¸¸ğŸ’ªï¼ˆå®Ÿãƒ¦ãƒ¼ã‚¶ãƒ¼åŸºæº–ã§ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã—ã¦ãã‚Œã‚‹ï¼‰ ([Google ãƒ˜ãƒ«ãƒ—][4])

---

## 5) Next.jsã§â€œã‚†ã‚‹ãåŠ¹ãâ€æ”¹å–„ãƒã‚¤ãƒ³ãƒˆğŸ§°âœ¨

ã“ã“ã¯ã€Œã‚ˆãã‚ã‚‹åŸå› ã€ã¨ã€Œæœ€åˆã®ä¸€æ‰‹ã€ã ã‘ã«çµã‚‹ã­ğŸ˜ŠğŸŒ¸

### ğŸƒâ€â™€ï¸ LCPï¼ˆè¡¨ç¤ºãŒé…ã„ï¼‰

ã‚ã‚ŠãŒã¡åŸå› ï¼š

* ã§ã‹ã„ç”»åƒï¼ˆç‰¹ã«ãƒ’ãƒ¼ãƒ­ãƒ¼ç”»åƒï¼‰ğŸ–¼ï¸ğŸ’¦
* ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ã§å¾…ã¤ğŸ”¤âŒ›
* ä½“æ„Ÿçš„ã«ã€Œæœ€åˆã®è¦‹ã©ã“ã‚ã€ãŒé…ã„

æœ€åˆã®ä¸€æ‰‹ï¼š

* **ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼ã®ç”»åƒã‚’è»½ã**ï¼ˆã‚µã‚¤ã‚ºãƒ»åœ§ç¸®ãƒ»é©åˆ‡ãªå½¢å¼ï¼‰
* **è¡¨ç¤ºã«å¿…è¦ãªè¦ç´ ã‚’å…ˆã«å‡ºã™**ï¼ˆä¸è¦ãªClientå¢ƒç•Œã‚’å¢—ã‚„ã•ãªã„ï¼‰
* ã€Œä¸»å½¹ã€ãŒç”»åƒãªã‚‰ `next/image` ã‚’ç´ ç›´ã«ä½¿ã†ï¼ˆå‰ç« ã¾ã§ã®çŸ¥è­˜ã§OKï¼‰ğŸ“¸âœ¨

### ğŸ–±ï¸ INPï¼ˆæŠ¼ã—ã¦ã‚‚åå¿œãŒé…ã„ï¼‰

ã‚ã‚ŠãŒã¡åŸå› ï¼š

* ã‚¯ãƒªãƒƒã‚¯æ™‚ã«é‡ã„å‡¦ç†ãŒèµ°ã‚‹ï¼ˆé•·ã„JSï¼‰ğŸ˜
* 1ç”»é¢ãœã‚“ã¶Clientã«ãªã£ã¦ã¦JSãŒå¤ªã„ğŸ’¦

æœ€åˆã®ä¸€æ‰‹ï¼š

* **Client Component ã‚’å¿…è¦æœ€å°é™ã«**ï¼ˆNext.jsã¯åŸºæœ¬Serverã§OKï¼‰
* ãƒœã‚¿ãƒ³æŠ¼ã—ãŸã¨ãã®å‡¦ç†ã‚’è»½ãï¼ˆé‡ã„è¨ˆç®—ã¯é¿ã‘ã‚‹/åˆ†å‰²ã™ã‚‹ï¼‰âœ‚ï¸

â€»INPãŒCWVã«ãªã£ã¦ã€FIDã‹ã‚‰ç½®ãæ›ã‚ã£ãŸã‚ˆï¼ˆ2024/3/12ï¼‰ğŸ“… ([web.dev][5])

### ğŸ“ CLSï¼ˆã‚¬ã‚¿ã‚¬ã‚¿å‹•ãï¼‰

ã‚ã‚ŠãŒã¡åŸå› ï¼š

* ç”»åƒã®ã‚µã‚¤ã‚ºæœªæŒ‡å®šï¼ˆè¡¨ç¤ºå¾Œã«ã‚ºãƒ¬ã‚‹ï¼‰ğŸ“¦â†•ï¸
* å¾Œã‹ã‚‰ãƒãƒŠãƒ¼/åºƒå‘Š/ãƒ•ã‚©ãƒ³ãƒˆãŒå…¥ã£ã¦æŠ¼ã—ä¸‹ã’ã‚‹

æœ€åˆã®ä¸€æ‰‹ï¼š

* **ç”»åƒãƒ»åŸ‹ã‚è¾¼ã¿è¦ç´ ã¯â€œå ´æ‰€å–ã‚Šâ€**ã™ã‚‹ï¼ˆå¹…/é«˜ã• or æ ã‚’å…ˆã«ç¢ºä¿ï¼‰
* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°UIã‚‚ã€Œé«˜ã•ã€ã‚’ç¢ºä¿ã—ã¦ã‚¬ã‚¿ã¤ãã‚’é˜²ãâ³ğŸ§±

---

## 6) ãŠã¾ã‘ï¼šNext.jsã§CWVã‚’ãƒ­ã‚°ã«å‡ºã—ã¦ã¿ã‚‹ï¼ˆè¶…ãƒŸãƒ‹ï¼‰ğŸ“âœ¨

ã€Œä»Šã©ã‚“ãªå€¤ãŒå‡ºã¦ã‚‹ã®ï¼Ÿã€ã‚’çŸ¥ã‚ŠãŸã„æ™‚ã¯ã€Next.js ã® `useReportWebVitals` ãŒä½¿ãˆã‚‹ã‚ˆğŸ™Œ
ï¼ˆApp Routerã§ã‚‚OKï¼‰ ([Next.js][6])

### æ‰‹é †ï¼ˆApp Routerï¼‰

1. `app/_components/WebVitals.tsx` ã‚’ä½œã‚‹
2. `app/layout.tsx` ã§èª­ã¿è¾¼ã‚€

#### `app/_components/WebVitals.tsx`

```tsx
'use client'

import { useReportWebVitals } from 'next/web-vitals'
import type { NextWebVitalsMetric } from 'next/app'

export function WebVitals() {
  useReportWebVitals((metric: NextWebVitalsMetric) => {
    // é–‹ç™ºä¸­ã¯consoleã§OKğŸ‘Œ æœ¬ç•ªã¯åˆ†æåŸºç›¤ã«é€ã‚‹ã“ã¨ãŒå¤šã„ã‚ˆğŸ“®
    console.log('[WebVitals]', metric.name, metric.value)
  })

  return null
}
```

#### `app/layout.tsx`

```tsx
import { WebVitals } from './_components/WebVitals'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="ja">
      <body>
        <WebVitals />
        {children}
      </body>
    </html>
  )
}
```

> ãƒã‚¤ãƒ³ãƒˆï¼šã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã ã‘ã‚’Clientã«ã—ã¦ã€**Clientå¢ƒç•Œã‚’å°ã•ãä¿ã¤**ã®ãŒã‚³ãƒ„ã ã‚ˆã€œğŸ§Šâœ¨ ([Next.js][6])

---

## ãƒŸãƒ‹ç·´ç¿’ï¼ˆ5åˆ†ï¼‰â±ï¸âœ¨

1. Lighthouse ã‚’1å›å›ã™ğŸ§ª
2. **CLSãŒé«˜ã„**ãªã‚‰ã€Œç”»åƒ/ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®å ´æ‰€å–ã‚Šã€ã‚’ç–‘ã†ğŸ“¦
3. **INPãŒæ‚ªã„**ãªã‚‰ã€ŒClientç¯„å›²ãŒåºƒã™ããªã„ï¼Ÿã€ã‚’ç–‘ã†ğŸ–±ï¸
4. â€œèµ¤â†’é»„â€ ã«ãªã£ãŸã‚‰ä»Šæ—¥ã¯å‹ã¡ğŸ†ğŸ‰

---

ã“ã®ç« ã¯ã“ã“ã¾ã§ã ã‚ˆã€œğŸ˜Šâœ¨
æ¬¡ã®ç« ï¼ˆç¬¬200ç« ï¼‰ã¯ã€Œç”»åƒãŒé‡ã„æ™‚ã®â€œã¾ãšã“ã‚Œâ€ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆâœ…ã€ã ã‹ã‚‰ã€**LCPãŒæ°—ã«ãªã‚‹äººã¯è¶…ã¤ãªãŒã‚‹**ã‚ˆğŸ–¼ï¸ğŸ’¨

[1]: https://developers.google.com/speed/docs/insights/v5/about "About PageSpeed Insights Â |Â  Google for Developers"
[2]: https://developers.google.com/search/docs/appearance/core-web-vitals "Understanding Core Web Vitals and Google search results | Google Search Central Â |Â  Documentation Â |Â  Google for Developers"
[3]: https://web.dev/articles/defining-core-web-vitals-thresholds "How the Core Web Vitals metrics thresholds were defined Â |Â  Articles Â |Â  web.dev"
[4]: https://support.google.com/webmasters/answer/9205520?hl=en&utm_source=chatgpt.com "Core Web Vitals report - Search Console Help"
[5]: https://web.dev/blog/inp-cwv-march-12 "Interaction to Next Paint becomes a Core Web Vital on March 12 Â |Â  Blog Â |Â  web.dev"
[6]: https://nextjs.org/docs/app/api-reference/functions/use-report-web-vitals "Functions: useReportWebVitals | Next.js"
