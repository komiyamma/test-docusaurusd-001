# ç¬¬176ç« ï¼šNext.jsã®èªè¨¼ã¯â€œæ–¹å¼ã‚’é¸ã¶â€ã‹ã‚‰å§‹ã¾ã‚‹ğŸ›ï¸

èªè¨¼ã£ã¦ã€ã„ããªã‚Šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¥ã‚Œã‚‹å‰ã« **ã€Œã©ã®æ–¹å¼ã«ã™ã‚‹ï¼Ÿã€ã‚’æ±ºã‚ã‚‹** ã®ãŒè¶…å¤§äº‹ã ã‚ˆã€œï¼ğŸ§ ğŸ’¡
å…ˆã«ã“ã“ã‚’æ±ºã‚ã‚‹ã¨ã€å¾Œã®å®Ÿè£…ãŒã‚¹ãƒ«ã‚¹ãƒ«é€²ã‚€âœ¨ï¼ˆé€†ã«ã€ã“ã“ãŒãƒ•ãƒ¯ãƒƒã¨ã—ã¦ã‚‹ã¨è¿·å­ã«ãªã‚ŠãŒã¡ğŸ¥ºï¼‰

---

## ã“ã®ç« ã®ã‚´ãƒ¼ãƒ«ğŸâœ¨

* è‡ªåˆ†ã®ã‚¢ãƒ—ãƒªã«åˆã†ã€Œãƒ­ã‚°ã‚¤ãƒ³æ–¹å¼ã€ã‚’é¸ã¹ã‚‹ã‚ˆã†ã«ãªã‚‹ğŸ¯
* ã€Œã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ï¼‰ã€ã®æŒã¡æ–¹ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ãã‚‹ğŸªğŸªª
* Next.jsï¼ˆApp Routerï¼‰ã§â€œã©ã“ã§èªè¨¼ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‹â€ã®å…¨ä½“åƒãŒåˆ†ã‹ã‚‹ğŸ—ºï¸

---

## ã¾ãšã¯èªè¨¼ã‚’3ã¤ã«åˆ†ã‘ã¦è€ƒãˆã‚‹ã‚ˆğŸ§©ğŸ§©ğŸ§©

Next.jsã®å…¬å¼ã‚¬ã‚¤ãƒ‰ã§ã‚‚ã€èªè¨¼ã¾ã‚ã‚Šã¯å¤§ãã **3ã¤ã®æ¦‚å¿µ** ã«åˆ†ã‘ã¦è€ƒãˆã‚‹ã®ãŒã‚³ãƒ„ã£ã¦æµã‚Œã«ãªã£ã¦ã‚‹ã‚ˆğŸ“˜âœ¨ã€‚([Next.js][1])

1. **Authenticationï¼ˆæœ¬äººç¢ºèªï¼‰**ï¼šãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼Ÿå¤±æ•—ï¼ŸğŸ‘¤
2. **Session Managementï¼ˆãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®ä¿æŒï¼‰**ï¼šãƒ­ã‚°ã‚¤ãƒ³ä¸­ã‚’ã©ã†è¦šãˆã‚‹ï¼ŸğŸª
3. **Authorizationï¼ˆæ¨©é™ãƒ»ä¿è­·ï¼‰**ï¼šã“ã®ãƒšãƒ¼ã‚¸å…¥ã£ã¦ã„ã„äººï¼ŸğŸšªğŸ›¡ï¸

ã“ã®ç« ã¯ã¾ãš **â‘ ã¨â‘¡ã®ã€Œæ–¹å¼é¸ã³ã€** ãŒä¸»å½¹ã ã‚ˆğŸ›ï¸âœ¨

---

## æ–¹å¼é¸ã³ã§æ±ºã‚ã‚‹ã“ã¨ã¯ã€ã ã„ãŸã„ã“ã®2ã¤ğŸ›ï¸ğŸ”

### A. ä½•ã§ãƒ­ã‚°ã‚¤ãƒ³ã•ã›ã‚‹ï¼Ÿï¼ˆãƒ­ã‚°ã‚¤ãƒ³æ‰‹æ®µï¼‰ğŸ§©

* **ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆOAuthï¼‰**ï¼šGoogle / GitHub ãªã©âœ¨
* **ãƒ¡ãƒ¼ãƒ«ï¼ˆãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ï¼‰**ï¼šãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã—ã§ãƒ¡ãƒ¼ãƒ«ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ğŸ“©
* **ID/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆCredentialsï¼‰**ï¼šç‹é“ã ã‘ã©é‹ç”¨ã¯ã¡ã‚‡ã„å¤§å¤‰ğŸ”‘

### B. ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰ã‚’ã©ã†æŒã¤ï¼ŸğŸªğŸªª

* **Cookieãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³**ï¼ˆWebã‚¢ãƒ—ãƒªã¨ç›¸æ€§â—ï¼‰ğŸª
* **JWTãƒ™ãƒ¼ã‚¹**ï¼ˆå¤–éƒ¨API/ãƒ¢ãƒã‚¤ãƒ«/åˆ¥ã‚µãƒ¼ãƒ“ã‚¹é€£æºãŒå¢—ãˆã‚‹ã¨å‡ºç•ªï¼‰ğŸªª

---

## å›³è§£ï¼šèªè¨¼æ–¹å¼ã®é¸ã³æ–¹ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆğŸ›ï¸ğŸ—ºï¸

![next_study_176_auth_choices](./picture/next_study_176_auth_choices.png)

```mermaid
flowchart TD
  A["ã¾ãšæ±ºã‚ã‚‹ğŸ›ï¸ ä½•ã§ãƒ­ã‚°ã‚¤ãƒ³ï¼Ÿ"] --> B{"ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ã©ã†ä½œã‚‹ï¼Ÿ"}
  B -->|"Google/GitHubãªã©âœ¨"| C["OAuthï¼ˆã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³ï¼‰"]
  B -->|"ãƒ¡ãƒ¼ãƒ«ã ã‘ã§OKğŸ“©"| D["Emailï¼ˆãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ï¼‰"]
  B -->|"ID/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ğŸ”‘"| E["Credentialsï¼ˆè‡ªå‰ï¼‰"]

  C --> F{"ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã¯ã©ã†ä¿æŒã™ã‚‹ï¼Ÿ"}
  D --> F
  E --> F

  F -->|"Webã‚¢ãƒ—ãƒªä¸­å¿ƒğŸª"| G["Cookieãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³"]
  F -->|"å¤–éƒ¨API/ãƒ¢ãƒã‚¤ãƒ«ã‚‚ğŸªª"| H["JWTãƒ™ãƒ¼ã‚¹ï¼ˆé‹ç”¨æ³¨æ„ï¼‰"]

  G --> I{"èªè¨¼ãƒã‚§ãƒƒã‚¯ã¯ã©ã“ã§ï¼Ÿ"}
  H --> I

  I -->|"ãƒšãƒ¼ã‚¸å‰ã§æ­¢ã‚ãŸã„ğŸš§"| J["Middlewareã§ã‚¬ãƒ¼ãƒ‰"]
  I -->|"ç¢ºå®Ÿã«å®ˆã‚ŠãŸã„ğŸ›¡ï¸"| K["Server Component / Route Handlerã§ã‚¬ãƒ¼ãƒ‰"]
  I -->|"è¦‹ãŸç›®ã ã‘å‡ºã—åˆ†ã‘ğŸ¨"| L["Clientã§è¡¨ç¤ºåˆ‡æ›¿ï¼ˆæœ€çµ‚é˜²è¡›ã«ã¯ã—ãªã„ï¼‰"]
```

---

## ä»£è¡¨çš„ãªã€Œé¸æŠè‚¢ã€4ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆã–ã£ãã‚Šï¼‰ğŸâœ¨

### â‘  Auth.jsï¼ˆNextAuthï¼‰ç³»ã‚’ä½¿ã†ï¼ˆç‹é“ãƒ»Next.jsã¨ç›¸æ€§â—ï¼‰ğŸ§©âœ¨

* ã€Œãƒ—ãƒ­ãƒã‚¤ãƒ€ï¼ˆGoogleç­‰ï¼‰ã€ã¨ã€Œã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã€ã‚’ã¾ã¨ã‚ã¦é¢å€’ã¿ã¦ãã‚Œã‚‹æ„Ÿã˜ğŸ«¶
* Next.jsã®æ•™æã‚„å…¬å¼Learnã§ã‚‚ NextAuth.js ã‚’ä½¿ã†æµã‚ŒãŒã‚ã‚‹ã‚ˆğŸ“˜âœ¨ã€‚([Next.js][2])
* æœ€è¿‘ã®Auth.jsï¼ˆNextAuth v5ç³»ï¼‰ã ã¨ã€ã‚µãƒ¼ãƒãƒ¼å´ã§ `auth()` ã¿ãŸã„ã«å‘¼ã¹ã‚‹è¨­è¨ˆãŒç´¹ä»‹ã•ã‚Œã¦ã‚‹ã‚ˆğŸ§ ğŸªã€‚([Auth.js][3])

ã“ã‚“ãªäººã«ãŠã™ã™ã‚ğŸ‘‡

* Webã‚¢ãƒ—ãƒªä¸­å¿ƒï¼ˆã¾ãšã¯æ™®é€šã®ãƒ­ã‚°ã‚¤ãƒ³ã‚’ä½œã‚ŠãŸã„ï¼‰ğŸ˜Š
* App Routerã§â€œã‚µãƒ¼ãƒãƒ¼ã§å®ˆã‚‹â€è¨­è¨ˆã«å¯„ã›ãŸã„ğŸ›¡ï¸

---

### â‘¡ èªè¨¼SaaSï¼ˆClerk/Auth0ç­‰ï¼‰ã‚’ä½¿ã†ï¼ˆæœ€é€Ÿã§å®Œæˆï¼‰ğŸš€âœ¨

* UIã‚„ç®¡ç†ç”»é¢ã¾ã§ç”¨æ„ã•ã‚Œã¦ã‚‹ã“ã¨ãŒå¤šã„ğŸª„
* ã¨ã«ã‹ãæ—©ãã€Œãƒ­ã‚°ã‚¤ãƒ³ä»˜ãã‚¢ãƒ—ãƒªã€ã‚’å®Œæˆã•ã›ãŸã„æ™‚ã«å¼·ã„ğŸ’¨
* ãŸã ã—æ–™é‡‘ã‚„ãƒ­ãƒƒã‚¯ã‚¤ãƒ³ã€ã‚«ã‚¹ã‚¿ãƒ åº¦ã‚‚è¦ãƒã‚§ãƒƒã‚¯ğŸ‘›ğŸ”

ï¼ˆä¾‹ã¨ã—ã¦ã€Clerkã¯App Routerå‘ã‘ã®èªè¨¼ãƒ‘ã‚¿ãƒ¼ãƒ³è§£èª¬ã‚‚å‡ºã—ã¦ã‚‹ã‚ˆğŸ“šï¼‰([Clerk][4])

---

### â‘¢ BaaSï¼ˆFirebase/Supabaseç­‰ï¼‰ã®èªè¨¼ã‚’ä½¿ã†ï¼ˆDBã¨ã‚»ãƒƒãƒˆã§ä¾¿åˆ©ï¼‰ğŸ—ƒï¸âœ¨

* èªè¨¼ï¼‹DBï¼‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãŒã‚»ãƒƒãƒˆã§æ¥½ãªã“ã¨ãŒå¤šã„ğŸ§°
* ã™ã§ã«ãã®BaaSã‚’ä½¿ã†å‰æãªã‚‰è‡ªç„¶ãªé¸æŠğŸ‘

---

### â‘£ è‡ªå‰å®Ÿè£…ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰/ãƒãƒƒã‚·ãƒ¥/ãƒªã‚»ãƒƒãƒˆç­‰å…¨éƒ¨ï¼‰ğŸ§±ğŸ« 

* å­¦ã³ã«ã¯ãªã‚‹ã‘ã©ã€**å®Ÿé‹ç”¨ã ã¨åœ°é›·ãŒå¤šã„**ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ/äºŒè¦ç´ /æ”»æ’ƒå¯¾ç­–â€¦ï¼‰ğŸ’£
* â€œå‹‰å¼·ã¨ã—ã¦1å›ã‚„ã‚‹â€ãªã‚‰OKã€å®Ÿæ¡ˆä»¶ã¯æ…é‡ã«âš ï¸

---

## Cookieã‚»ãƒƒã‚·ãƒ§ãƒ³ vs JWTï¼šè¶…ã–ã£ãã‚Šæ¯”è¼ƒğŸªğŸªª

| æ–¹å¼            | ã„ã„ã¨ã“ã‚ğŸ˜Š               | æ°—ã‚’ã¤ã‘ã©ã“ã‚âš ï¸                                 | å‘ã„ã¦ã‚‹      |
| ------------- | --------------------- | ----------------------------------------- | --------- |
| Cookieã‚»ãƒƒã‚·ãƒ§ãƒ³ğŸª | ãƒ–ãƒ©ã‚¦ã‚¶ã¨ç›¸æ€§â— / ã‚µãƒ¼ãƒãƒ¼ã§å®ˆã‚Šã‚„ã™ã„ | Cookieè¨­å®šï¼ˆSecure/HttpOnly/SameSiteï¼‰ã‚’ã¡ã‚ƒã‚“ã¨ã™ã‚‹ | æ™®é€šã®Webã‚¢ãƒ—ãƒª |
| JWTğŸªª         | åˆ¥ã‚µãƒ¼ãƒ“ã‚¹/ãƒ¢ãƒã‚¤ãƒ«é€£æºã—ã‚„ã™ã„      | å¤±åŠ¹ç®¡ç†ãƒ»æ¼ãˆã„æ™‚ãŒå¤§å¤‰ã«ãªã‚ŠãŒã¡                         | APIé€£æºå¤šã‚   |

â€»JWTã‚’ä½¿ã†ã¨ã—ã¦ã‚‚ã€**ãƒ–ãƒ©ã‚¦ã‚¶ã§é›‘ã«ä¿å­˜ï¼ˆä¾‹ï¼šlocalStorageï¼‰**ã¿ãŸã„ãªã®ã¯é¿ã‘ãŸã„æ´¾ãŒå¤šã„ã‚ˆã€œğŸ˜µâ€ğŸ’«ï¼ˆæ”»æ’ƒé¢ãŒå¢—ãˆã‚‹ï¼‰

---

## App Routerã ã¨ã€Œã‚µãƒ¼ãƒãƒ¼ã§èªè¨¼ãƒã‚§ãƒƒã‚¯ã€ãŒã‚„ã‚Šã‚„ã™ã„ğŸ›¡ï¸âœ¨

App Routerã¯ã‚µãƒ¼ãƒãƒ¼ã§å‹•ãéƒ¨åˆ†ãŒå¼·ã„ã‹ã‚‰ã€
ã€Œãƒšãƒ¼ã‚¸è¡¨ç¤ºã™ã‚‹å‰ã«ã‚µãƒ¼ãƒãƒ¼ã§ session ã‚’è¦‹ã¦åˆ¤æ–­ã€ã—ã‚„ã™ã„ã®ãŒé­…åŠ›ğŸ’

Auth.jsï¼ˆNextAuth v5ç³»ï¼‰ã ã¨ã€ã‚µãƒ¼ãƒãƒ¼å´ã§ `auth()` ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å–ã‚‹ä¾‹ãŒå…¬å¼ã«ã‚ã‚‹ã‚ˆğŸªâœ¨ã€‚([Auth.js][5])

---

## å›³è§£ï¼šãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®â€œèªè¨¼ãƒã‚§ãƒƒã‚¯ä½ç½®â€ã‚¤ãƒ¡ãƒ¼ã‚¸ğŸ“¨ğŸ›¡ï¸

```mermaid
sequenceDiagram
  participant U as BrowserğŸŒ
  participant N as Next.js("App Router")ğŸ§ 
  participant MW as MiddlewareğŸ§¤
  participant DB as Session/DBğŸ—ƒï¸

  U->>N: /dashboard ã«ã‚¢ã‚¯ã‚»ã‚¹ğŸ“¨
  N->>MW: ï¼ˆå¿…è¦ãªã‚‰ï¼‰å…ˆã«é€šéãƒã‚§ãƒƒã‚¯ğŸ§¤
  MW-->>N: OK or /loginã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆğŸš¦
  N->>DB: ã‚µãƒ¼ãƒãƒ¼ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³å‚ç…§ğŸª
  DB-->>N: session / user æƒ…å ±ğŸ‘¤
  N-->>U: ç”»é¢ã‚’è¿”ã™ï¼ˆãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã§å‡ºã—åˆ†ã‘ï¼‰âœ¨
```

---

## ãƒŸãƒ‹æ¼”ç¿’ğŸ’âœ¨ï¼šã€Œã‚ãªãŸãªã‚‰ã©ã‚Œã‚’é¸ã¶ï¼Ÿã€ï¼ˆç­”ãˆä¾‹ã¤ãï¼‰

### ãŠé¡Œï¼šå­¦å†…ã‚µãƒ¼ã‚¯ãƒ«ã®ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†ã‚¢ãƒ—ãƒªğŸ€

* ãƒ¡ãƒ³ãƒãƒ¼ã ã‘ãŒã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œã‚Œã‚‹ğŸ“
* ä¸€èˆ¬ã®äººã¯é–²è¦§ã ã‘ğŸ‘€
* ãƒ­ã‚°ã‚¤ãƒ³ã¯Googleã§OKï¼ˆå­¦æ ¡ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ³å®šï¼‰ğŸ«âœ¨
* ã¾ãšã¯Webã ã‘ã§é‹ç”¨ğŸ“±ğŸ’»

âœ…ãŠã™ã™ã‚ã®é¸ã³æ–¹ï¼ˆä¾‹ï¼‰

* ãƒ­ã‚°ã‚¤ãƒ³æ‰‹æ®µï¼š**OAuthï¼ˆGoogleï¼‰**âœ¨
* ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼š**Cookieãƒ™ãƒ¼ã‚¹**ğŸªï¼ˆWebä¸­å¿ƒã ã—ï¼‰
* å®Ÿè£…ï¼š**Auth.jsï¼ˆNextAuthï¼‰**ã§ã¾ã¨ã‚ã¦ç®¡ç†ğŸ§©ï¼ˆå°å…¥ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯æ¬¡ç« ï¼ï¼‰

---

## æ–¹å¼é¸ã³ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆâœ…âœ¨ï¼ˆã“ã‚Œã ã‘æ±ºã‚ã‚Œã°è¿·ã„æ¿€æ¸›ï¼‰

* ãƒ­ã‚°ã‚¤ãƒ³ã¯ **ä½•ã§** ã‚„ã‚‹ï¼Ÿï¼ˆOAuth/ãƒ¡ãƒ¼ãƒ«/IDPWï¼‰ğŸ”‘ğŸ“©âœ¨
* ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã¯ **Cookieã‚»ãƒƒã‚·ãƒ§ãƒ³ or JWT**ï¼ŸğŸªğŸªª
* å®ˆã‚ŠãŸã„å ´æ‰€ã¯ã©ã“ï¼Ÿï¼ˆãƒšãƒ¼ã‚¸/API/ç‰¹å®šãƒ«ãƒ¼ãƒˆï¼‰ğŸšªğŸ›¡ï¸
* DBã¯ä½¿ã†ï¼Ÿï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç½®ãï¼Ÿï¼‰ğŸ—ƒï¸
* â€œæœ€åˆã¯Webã ã‘ï¼Ÿâ€ â€œå°†æ¥ãƒ¢ãƒã‚¤ãƒ«/å¤–éƒ¨APIï¼Ÿâ€ğŸ“±ğŸ”

---

## æ¬¡ç« ã«ã¤ãªãŒã‚‹ä¸€è¨€ğŸŒ¸

æ–¹å¼ãŒæ±ºã¾ã£ãŸã‚‰ã€æ¬¡ã¯ã„ã‚ˆã„ã‚ˆ **Auth.jsï¼ˆNextAuthï¼‰å°å…¥ã®å…¨ä½“åƒ** ã«å…¥ã£ã¦ã„ãã‚ˆã€œï¼ğŸ§©ğŸš€ï¼ˆç¬¬177ç« ï¼‰

â€»ã‚ã¨ã€Next.jsã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¿®æ­£ãŒã¡ã‚‡ã“ã¡ã‚‡ã“å…¥ã‚‹ã®ã§ã€ä¾å­˜é–¢ä¿‚ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®ç¿’æ…£ã‚‚å¤§äº‹ã ã‚ˆğŸ›¡ï¸ğŸ”ã€‚([Next.js][6])

[1]: https://nextjs.org/docs/app/guides/authentication?utm_source=chatgpt.com "Guides: Authentication"
[2]: https://nextjs.org/learn/dashboard-app/adding-authentication?utm_source=chatgpt.com "App Router: Adding Authentication"
[3]: https://authjs.dev/getting-started/session-management/get-session?utm_source=chatgpt.com "Get Session"
[4]: https://clerk.com/articles/complete-authentication-guide-for-nextjs-app-router?utm_source=chatgpt.com "Complete Authentication Guide for Next.js App Router in ..."
[5]: https://authjs.dev/getting-started/session-management/protecting?utm_source=chatgpt.com "Protecting Resources"
[6]: https://nextjs.org/support-policy?utm_source=chatgpt.com "Support Policy"
