# ç¬¬236ç« ï¼šDBè¨­è¨ˆï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«2ã€œ4å€‹ã§ååˆ†ï¼‰ğŸ—ƒï¸

å’æ¥­åˆ¶ä½œã®DBè¨­è¨ˆã¯ã€**ã€Œæœ€å°ã§å‹•ãå½¢ã€**ã«ã™ã‚‹ã®ãŒã„ã¡ã°ã‚“å¼·ã„ã‚ˆã€œï¼ğŸ˜ŠğŸŒ¸
ã“ã“ã§ã¯ã€**2ã€œ4ãƒ†ãƒ¼ãƒ–ãƒ«**ã§ã‚¹ãƒƒã‚­ãƒªã¾ã¨ã¾ã‚‹è¨­è¨ˆã®ä½œã‚Šæ–¹ã‚’ã‚„ã£ã¦ã„ãã­âœï¸ğŸ’•

---

## ğŸ¯ ã“ã®ç« ã®ã‚´ãƒ¼ãƒ«

* ã€Œãƒ†ãƒ¼ãƒ–ãƒ«ã£ã¦ä½•ã‚’ä½œã‚Œã°ã„ã„ã®ï¼Ÿã€ãŒè¿·ã‚ãªããªã‚‹ğŸ§ âœ¨
* **2ã€œ4ãƒ†ãƒ¼ãƒ–ãƒ«**ã§å’æ¥­åˆ¶ä½œã«ååˆ†ãªDBè¨­è¨ˆãŒã§ãã‚‹âœ…
* **1å¯¾å¤š / å¤šå¯¾å¤š**ãŒã–ã£ãã‚Šæã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ğŸª„

---

## ğŸ§ ã¾ãšçµè«–ï¼šãƒ†ãƒ¼ãƒ–ãƒ«ã¯â€œå°‘ãªã„ã»ã©æ­£ç¾©â€ğŸ¥°

å’æ¥­åˆ¶ä½œã§æœ€åˆã‹ã‚‰ãƒ†ãƒ¼ãƒ–ãƒ«å¢—ã‚„ã™ã¨â€¦
ã€Œã©ã“ã§ä½•ã‚’ä¿å­˜ã—ã¦ã‚‹ã®ã‹åˆ†ã‹ã‚‰ã‚“ğŸ˜µâ€ğŸ’«ã€ã£ã¦ãªã‚ŠãŒã¡ï¼

ã ã‹ã‚‰æœ€åˆã¯ã“ã‚Œã§OKğŸ‘‡

* **2ãƒ†ãƒ¼ãƒ–ãƒ«**ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‹ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ï¼ˆä¾‹ï¼šUser + Noteï¼‰ğŸ“
* **3ãƒ†ãƒ¼ãƒ–ãƒ«**ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‹ãƒ¡ã‚¤ãƒ³ï¼‹å±¥æ­´/æŠ•ç¨¿ï¼ˆä¾‹ï¼šUser + Cafe + Reviewï¼‰â˜•
* **4ãƒ†ãƒ¼ãƒ–ãƒ«**ï¼šå¤šå¯¾å¤šï¼ˆä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ãŒå¿…è¦ãªã¨ãï¼ˆä¾‹ï¼šTagä»˜ã‘ï¼‰ğŸ·ï¸

---

## ğŸ§­ DBè¨­è¨ˆã®æ‰‹é †ï¼ˆã“ã®é †ã§ã‚„ã‚‹ã¨è¿·å­ã«ãªã‚‰ãªã„ï¼‰ğŸ—ºï¸âœ¨

![alt](./picture/next_study_236_db_design.png)

```mermaid
flowchart TD
  A["ã‚„ã‚ŠãŸã„æ©Ÿèƒ½ã‚’3ã€œ5å€‹ã«çµã‚‹"] --> B["åè©ã‚’æŠœãå‡ºã™<br/>ä¾‹: ãƒ¦ãƒ¼ã‚¶ãƒ¼/æŠ•ç¨¿/ã‚³ãƒ¡ãƒ³ãƒˆ"]
  B --> C["ãƒ†ãƒ¼ãƒ–ãƒ«å€™è£œã«ã™ã‚‹"]
  C --> D["é–¢ä¿‚ã‚’æ±ºã‚ã‚‹<br/>1å¯¾å¤š / å¤šå¯¾å¤š"]
  D --> E["ã‚«ãƒ©ãƒ ã‚’æ±ºã‚ã‚‹<br/>å¿…é ˆ/ä»»æ„/å‹"]
  E --> F["åˆ¶ç´„ã‚’æ±ºã‚ã‚‹<br/>unique/å‰Šé™¤æ™‚ã®æ‰±ã„"]
  F --> G["ERå›³ã«ã—ã¦å®Œæˆ"]
```

ãƒã‚¤ãƒ³ãƒˆã¯ **ã€Œç”»é¢ã€ã‚ˆã‚Šå…ˆã«ã€Œãƒ‡ãƒ¼ã‚¿ã€**ã‚’æ±ºã‚ã‚‹ã“ã¨ã ã‚ˆğŸ˜Šâœ¨
ç”»é¢ã¯å¾Œã‹ã‚‰ã„ãã‚‰ã§ã‚‚ç›´ã›ã‚‹ã‘ã©ã€DBã¯å¾Œã‹ã‚‰ç›´ã™ã¨å¤§å¤‰ã«ãªã‚ŠãŒã¡â€¦ï¼ğŸ˜‡

---

## ğŸ§ª ä¾‹é¡Œï¼šã‚«ãƒ•ã‚§ãƒ¡ãƒ¢ã‚¢ãƒ—ãƒªï¼ˆ3ãƒ†ãƒ¼ãƒ–ãƒ«ã§å®Œæˆï¼‰â˜•ğŸ“’âœ¨

ã€Œã‚­ãƒ£ãƒ³ãƒ‘ã‚¹å‘¨è¾ºã®ã‚«ãƒ•ã‚§ã‚’ãƒ¡ãƒ¢ã—ã¦ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã‚‹ã€æƒ³å®šã­ğŸ°ğŸ’•

### âœ… ã¾ãšæ©Ÿèƒ½ã‚’æœ€å°ã«ã™ã‚‹ï¼ˆä¾‹ï¼‰

* ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ã‚‹ï¼‰ğŸ”‘
* ã‚«ãƒ•ã‚§ã‚’ç™»éŒ²ã§ãã‚‹â˜•
* ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã‚‹â­ğŸ“

ã“ã“ã‹ã‚‰ã€Œåè©ã€ã‚’æŠœãå‡ºã™ã¨â€¦

* ãƒ¦ãƒ¼ã‚¶ãƒ¼
* ã‚«ãƒ•ã‚§
* ãƒ¬ãƒ“ãƒ¥ãƒ¼

â†’ **3ãƒ†ãƒ¼ãƒ–ãƒ«ã§OKï¼** ğŸ‰

---

## ğŸ§© ãƒ†ãƒ¼ãƒ–ãƒ«æ¡ˆï¼ˆæœ€å°ã‚»ãƒƒãƒˆï¼‰ğŸ“Œ

### 1) usersï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰

* idï¼ˆä¸»ã‚­ãƒ¼ï¼‰
* name
* emailï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰
* createdAt / updatedAtï¼ˆä½œæˆæ—¥/æ›´æ–°æ—¥ï¼‰

### 2) cafesï¼ˆã‚«ãƒ•ã‚§ï¼‰

* idï¼ˆä¸»ã‚­ãƒ¼ï¼‰
* name
* areaï¼ˆæœ€å¯„ã‚Šé§…ã¨ã‹ï¼‰
* urlï¼ˆä»»æ„ï¼‰
* createdAt / updatedAt

### 3) reviewsï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰

* idï¼ˆä¸»ã‚­ãƒ¼ï¼‰
* userIdï¼ˆèª°ãŒæ›¸ã„ãŸï¼Ÿï¼‰
* cafeIdï¼ˆã©ã®ã‚«ãƒ•ã‚§ï¼Ÿï¼‰
* ratingï¼ˆ1ã€œ5ï¼‰
* comment
* createdAt / updatedAt

---

## ğŸ§  é–¢ä¿‚ï¼ˆãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã‚’æ±ºã‚ã‚ˆã†âœ¨

* ãƒ¦ãƒ¼ã‚¶ãƒ¼1äººã¯ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ãŸãã•ã‚“æ›¸ã‘ã‚‹ â†’ **User 1 : Review å¤š**
* ã‚«ãƒ•ã‚§1ã¤ã¯ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ãŸãã•ã‚“æŒã¦ã‚‹ â†’ **Cafe 1 : Review å¤š**

```mermaid
erDiagram
  USER ||--o{ REVIEW : writes
  CAFE ||--o{ REVIEW : has

  USER {
    string id PK
    string name
    string email "unique"
    datetime createdAt
    datetime updatedAt
  }

  CAFE {
    string id PK
    string name
    string area
    string url "optional"
    datetime createdAt
    datetime updatedAt
  }

  REVIEW {
    string id PK
    string userId FK
    string cafeId FK
    int rating
    string comment
    datetime createdAt
    datetime updatedAt
  }
```

---

## ğŸ§· åˆ¶ç´„ï¼ˆãƒ«ãƒ¼ãƒ«ï¼‰ã‚’ã¡ã‚‡ã„è¶³ã—ã™ã‚‹ã¨å¼·ã„ğŸ’ªâœ¨

æœ€ä½é™ãŠã™ã™ã‚ğŸ‘‡

* **users.email ã¯ unique**ï¼ˆåŒã˜ãƒ¡ãƒ¼ãƒ«ã§2äººä½œã‚Œãªã„ï¼‰ğŸ“§ğŸ”’
* **reviews.rating ã¯ 1ã€œ5**ï¼ˆã“ã‚Œã¯DBã‚ˆã‚Šã€ã¾ãšã¯ã‚µãƒ¼ãƒãƒ¼å´ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚‚OKï¼‰â­
* **reviews ã¯ userId ã¨ cafeId ã‚’å¿…é ˆ**ï¼ˆèª°ã®ä½•ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‹åˆ†ã‹ã‚‰ãªã„ã®ã¯äº‹æ•…ï¼‰ğŸ’¥

å‰Šé™¤ã®æ‰±ã„ï¼ˆè¶…å¤§äº‹ï¼‰ã‚‚æ±ºã‚ã¨ãã¨å®‰å¿ƒğŸ˜Š

* ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ â†’ ãã®äººã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯ã©ã†ã™ã‚‹ï¼Ÿï¼ˆæ¶ˆã™ï¼Ÿæ®‹ã™ï¼Ÿï¼‰ğŸ§¹
* ã‚«ãƒ•ã‚§å‰Šé™¤ â†’ ç´ã¥ããƒ¬ãƒ“ãƒ¥ãƒ¼ã¯ã©ã†ã™ã‚‹ï¼Ÿï¼ˆæ™®é€šã¯ä¸€ç·’ã«æ¶ˆã™ã“ã¨å¤šã„ï¼‰ğŸ—‘ï¸

---

## ğŸ§ª Prismaã§ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆé›°å›²æ°—ã ã‘ï¼‰ğŸ§Šâœ¨

â€»ã€Œã“ã†ã„ã†å½¢ã«ãªã‚‹ã‚ˆã€œã€ã®å‚è€ƒã­ğŸ˜Š

```ts
model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  reviews   Review[]
}

model Cafe {
  id        String   @id @default(cuid())
  name      String
  area      String
  url       String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  reviews   Review[]
}

model Review {
  id        String   @id @default(cuid())
  userId    String
  cafeId    String
  rating    Int
  comment   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User @relation(fields: [userId], references: [id])
  cafe      Cafe @relation(fields: [cafeId], references: [id])
}
```

---

## âœ… ã“ã®ç« ã®æˆæœç‰©ï¼ˆã“ã‚ŒãŒæ›¸ã‘ãŸã‚‰å‹ã¡ï¼‰ğŸâœ¨

ã‚ãªãŸã®å’æ¥­åˆ¶ä½œã«ã¤ã„ã¦ã€ã“ã‚Œã‚’åŸ‹ã‚ã¦ã¿ã¦ã­ğŸ˜ŠğŸ“ğŸ’•

* ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ **2ã€œ4å€‹**ã«ã—ãŸï¼Ÿ
* ãã‚Œãã‚Œã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«

  * ä¸»ã‚­ãƒ¼ï¼ˆidï¼‰
  * createdAt / updatedAt
    ãŒã‚ã‚‹ï¼Ÿâ°
* é–¢ä¿‚ã¯æ±ºã¾ã£ãŸï¼Ÿï¼ˆ1å¯¾å¤š / å¤šå¯¾å¤šï¼‰ğŸ”—
* unique ã«ã—ãŸã„ã‚‚ã®ã¯æ±ºã‚ãŸï¼Ÿï¼ˆä¾‹ï¼šemailï¼‰ğŸ”’
* å‰Šé™¤æ™‚ã®æ‰±ã„ã‚’ä¸€è¨€ã§æ±ºã‚ãŸï¼Ÿï¼ˆæ¶ˆã™/æ®‹ã™ï¼‰ğŸ—‘ï¸

---

æ¬¡ã®ç« ã§UIè¨­è¨ˆã«å…¥ã‚‹ã¨ãã€ä»Šã®DBè¨­è¨ˆãŒã‚ã‚‹ã ã‘ã§ã‚ã£ã¡ã‚ƒãƒ©ã‚¯ã«ãªã‚‹ã‚ˆã€œï¼ğŸ˜ŠğŸ’–
