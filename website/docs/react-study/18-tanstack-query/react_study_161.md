# ç¬¬161ç« ï¼šã€Œãƒ‡ãƒ¼ã‚¿å–å¾—ã€ã®æ‚©ã¿ã©ã“ã‚

ï¼ˆãƒ­ãƒ¼ãƒ‰ä¸­ç®¡ç†ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»äºŒé‡é€ä¿¡â€¦æ‰‹å‹•ã¯ãƒ„ãƒ©ã‚¤ï¼ï¼‰

ã“ã®ç« ã¯ã€ŒTanStack Query ã‚’å…¥ã‚Œã‚‹å‰ã«ã€ã¾ãšâ€œæ‰‹å‹•ã§ã‚„ã‚‹ã¨ä½•ãŒã—ã‚“ã©ã„ã‹â€ã‚’ä½“é¨“ã—ã¦ã€ç´å¾—ã—ã¦ã‹ã‚‰æ¬¡ã¸é€²ã‚€ã€å›ã ã‚ˆã€œğŸ˜Šâœ¨
â€»æ¬¡ã®ç¬¬162ç« ã§ä¸€æ°—ã«æ¥½ã«ãªã‚‹ã‹ã‚‰ã€ã“ã“ã¯ã€Œã¤ã‚‰ã•ã®æ­£ä½“ã€ã‚’ã¤ã‹ã‚€ã®ãŒç›®çš„ï¼ğŸ’ªğŸ§ 

---

## ä»Šæ—¥ã®ã‚´ãƒ¼ãƒ« ğŸ¯

* æ‰‹å‹• `fetch + useEffect` ãŒ **ã©ã‚“ã©ã‚“å¢—æ®–ã—ã¦åœ°ç„ã«ãªã‚‹ç†ç”±**ãŒã‚ã‹ã‚‹ ğŸ˜‡â¡ï¸ğŸ˜‡ğŸ˜‡ğŸ˜‡
* ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ã€ŒäºŒé‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€ã€Œãƒ­ãƒ¼ãƒ‰ä¸­ã€ã€Œã‚¨ãƒ©ãƒ¼ã€ã€Œå†å–å¾—ã€â€¦ã“ã®ã¸ã‚“ã®æ‚©ã¿ãŒ **å…¨éƒ¨ã¤ãªãŒã£ã¦ã‚‹**ã£ã¦ç†è§£ã§ãã‚‹ ğŸ”—âœ¨

---

## ã¾ãšçµè«–ï¼šæ‰‹å‹•ãƒ‡ãƒ¼ã‚¿å–å¾—ã§èµ·ããŒã¡ãªå•é¡ŒãŸã¡ ğŸ§¨

ã‚ˆãã‚ã‚‹â€œã—ã‚“ã©ã„â€ã‚’ä¸¦ã¹ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ğŸ‘‡

* â³ **ãƒ­ãƒ¼ãƒ‰ä¸­ã®ç®¡ç†**ï¼šã©ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ `loading` ã‚’ true/false ã«ã™ã‚‹ã®â€¦ï¼Ÿ
* ğŸ’¥ **ã‚¨ãƒ©ãƒ¼ã®ç®¡ç†**ï¼šå¤±æ•—ã—ãŸã‚‰ï¼Ÿå†è©¦è¡Œã¯ï¼Ÿè¡¨ç¤ºã¯ï¼Ÿ
* ğŸ” **äºŒé‡é€ä¿¡ãƒ»äºŒé‡å–å¾—**ï¼šåŒã˜APIã‚’è¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå©ã„ã¦ã—ã¾ã†
* ğŸ§Š **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãªã„**ï¼šæˆ»ã£ãŸã‚‰ã¾ãŸå–å¾—ã€ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆãŸã‚‰å¤ã„ã€ãªã©
* ğŸ§ª **çŠ¶æ…‹ãŒå¢—ãˆã™ãã‚‹**ï¼š`data/loading/error` ã ã‘ã˜ã‚ƒè¶³ã‚Šãªããªã‚‹
* ğŸ§¹ **ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼ˆä¸­æ–­ï¼‰**ï¼šç”»é¢ç§»å‹•ã—ãŸã®ã« fetch ãŒå¸°ã£ã¦ãã¦ setStateâ€¦è­¦å‘Šã€œğŸ˜­
* ğŸ•°ï¸ **æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã«ä¿ã¤ä»•çµ„ã¿**ï¼šã„ã¤å†å–å¾—ã™ã‚‹ï¼Ÿæ‰‹å‹•ã§ï¼Ÿ
* ğŸ§· **åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’å…¨ç”»é¢ã§å…±æœ‰**ï¼šPropsåœ°ç„ or Contextåœ°ç„ or è‡ªä½œã‚­ãƒ£ãƒƒã‚·ãƒ¥åœ°ç„

---

## å›³ã§è¦‹ã‚‹ï¼šæ‰‹å‹• fetch ã¯ã€ŒçŠ¶æ…‹ãƒã‚·ãƒ³ã€ã«ãªã‚ŠãŒã¡ ğŸ¤–âš™ï¸ï¼ˆMermaidï¼‰

ã€Œãƒ‡ãƒ¼ã‚¿å–å¾—ã€ã£ã¦å®Ÿã¯ã€ã“ã†ã„ã†åˆ†å²ã ã‚‰ã‘ã®â€œçŠ¶æ…‹ç®¡ç†â€ãªã‚“ã ã‚ˆã­ğŸ˜µâ€ğŸ’«

```mermaid
flowchart LR
  A[ç”»é¢è¡¨ç¤º] --> B{å–å¾—æ¸ˆã¿?}
  B -- ã„ã„ãˆ --> C[loading=true]
  C --> D[fetché–‹å§‹]
  D --> E{æˆåŠŸ?}
  E -- ã¯ã„ --> F[dataã‚»ãƒƒãƒˆ]
  F --> G[loading=false]
  E -- ã„ã„ãˆ --> H[errorã‚»ãƒƒãƒˆ]
  H --> I[loading=false]
  I --> J{å†è©¦è¡Œã™ã‚‹?}
  J -- ã¯ã„ --> D
  J -- ã„ã„ãˆ --> K[ã‚¨ãƒ©ãƒ¼ç”»é¢]
  B -- ã¯ã„ --> L[ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¡¨ç¤º]
  L --> M{å¤ã„?}
  M -- ã¯ã„ --> D
  M -- ã„ã„ãˆ --> N[ãã®ã¾ã¾è¡¨ç¤º]
```

ã“ã‚Œã‚’æ¯å›ã€è‡ªåˆ†ã§æ›¸ã„ã¦ç¶­æŒã™ã‚‹ã®ãŒã‚­ãƒ„ã„â€¦ã£ã¦è©±ï¼ğŸ˜‡ğŸ§¯

---

## ä½“é¨“ï¼šã‚ã–ã¨â€œæ‰‹å‹•åœ°ç„â€ã‚’ä½œã£ã¦ã¿ã‚‹ ğŸ˜ˆğŸ§ª

ã“ã“ã§ã¯ã€**åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’2ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒåˆ¥ã€…ã«å–å¾—**ã—ã¦ã€äºŒé‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç›®ã§è¦‹ã¦ã¿ã‚ˆã€œğŸ‘€ğŸ“¡

### 1) ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒç„¡ã‘ã‚Œã°ä½œã‚‹ï¼ˆã‚ã‚‹ãªã‚‰ã‚¹ã‚­ãƒƒãƒ—ã§OKï¼‰ğŸ› ï¸

PowerShell ã§ğŸ‘‡

```bash
npm create vite@latest react-query-pain -- --template react-ts
cd react-query-pain
npm install
npm run dev
```

---

## 2) ã¾ãšã¯ â€œAPIé–¢æ•°â€ ã‚’ä½œã‚‹ ğŸ“„âœ¨

`src/api/posts.ts` ã‚’ä½œã£ã¦ã€ã“ã‚Œã‚’æ›¸ã„ã¦ã­ğŸ‘‡

```ts
export type Post = {
  id: number;
  title: string;
};

export async function fetchPosts(signal?: AbortSignal): Promise<Post[]> {
  const res = await fetch("https://jsonplaceholder.typicode.com/posts", { signal });

  if (!res.ok) {
    throw new Error(`HTTP Error: ${res.status}`);
  }

  const data = (await res.json()) as Array<{ id: number; title: string }>;
  return data.slice(0, 10).map((p) => ({ id: p.id, title: p.title }));
}
```

---

## 3) â€œäºŒé‡å–å¾—â€ ãŒèµ·ãã‚‹æ§‹æˆã‚’ä½œã‚‹ ğŸ¥²ğŸ¥²

`src/App.tsx` ã‚’ä¸¸ã”ã¨ã“ã‚Œã«ç½®ãæ›ãˆğŸ‘‡

```tsx
import { useEffect, useState } from "react";
import { fetchPosts, type Post } from "./api/posts";

function PostList() {
  const [posts, setPosts] = useState<Post[] | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const controller = new AbortController();

    setLoading(true);
    setError(null);

    fetchPosts(controller.signal)
      .then((data) => {
        setPosts(data);
      })
      .catch((e: unknown) => {
        // Abort ã¯ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã—ãªã„ï¼ˆã“ã†ã„ã†åˆ†å²ã‚‚åœ°å‘³ã«å¢—ãˆã‚‹â€¦ğŸ˜‡ï¼‰
        if (e instanceof DOMException && e.name === "AbortError") return;
        setError(e instanceof Error ? e.message : "Unknown error");
      })
      .finally(() => {
        setLoading(false);
      });

    return () => controller.abort();
  }, []);

  if (loading) return <p>PostList: èª­ã¿è¾¼ã¿ä¸­â€¦â³</p>;
  if (error) return <p>PostList: ã‚¨ãƒ©ãƒ¼ğŸ˜­ {error}</p>;
  if (!posts) return <p>PostList: ãƒ‡ãƒ¼ã‚¿ãªã—ğŸ«¥</p>;

  return (
    <div>
      <h2>PostList ğŸ“</h2>
      <ul>
        {posts.map((p) => (
          <li key={p.id}>{p.title}</li>
        ))}
      </ul>
    </div>
  );
}

function PostCount() {
  const [count, setCount] = useState<number | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const controller = new AbortController();

    setLoading(true);
    setError(null);

    fetchPosts(controller.signal)
      .then((data) => {
        setCount(data.length);
      })
      .catch((e: unknown) => {
        if (e instanceof DOMException && e.name === "AbortError") return;
        setError(e instanceof Error ? e.message : "Unknown error");
      })
      .finally(() => {
        setLoading(false);
      });

    return () => controller.abort();
  }, []);

  if (loading) return <p>PostCount: èª­ã¿è¾¼ã¿ä¸­â€¦â³</p>;
  if (error) return <p>PostCount: ã‚¨ãƒ©ãƒ¼ğŸ˜­ {error}</p>;
  if (count === null) return <p>PostCount: ãƒ‡ãƒ¼ã‚¿ãªã—ğŸ«¥</p>;

  return <p>PostCount: ä»¶æ•°ã¯ {count} ä»¶ã§ã™ğŸ“¦</p>;
}

export default function App() {
  return (
    <div style={{ padding: 16 }}>
      <h1>ç¬¬161ç« ï¼šæ‰‹å‹• fetch ã®ã—ã‚“ã©ã•ä½“é¨“ ğŸ˜µâ€ğŸ’«</h1>
      <PostCount />
      <hr />
      <PostList />
    </div>
  );
}
```

---

## 4) ã“ã“ã§ç¢ºèªï¼ğŸ‘€ğŸ“¡ï¼ˆè¶…ãŸã„ã›ã¤ï¼‰

ãƒ–ãƒ©ã‚¦ã‚¶ã® DevTools ã‚’é–‹ã„ã¦ï¼ˆF12ï¼‰ğŸ‘‰ Network ã‚¿ãƒ–ã‚’è¦‹ã‚‹ã¨â€¦

* **åŒã˜URLãŒ2å›**å‘¼ã°ã‚Œã¦ã‚‹ã¯ãšï¼ğŸ˜‡
  `PostCount` ã¨ `PostList` ãŒ **åˆ¥ã€…ã« fetch** ã—ã¦ã‚‹ã‹ã‚‰ã­ğŸ’¥

ã“ã‚ŒãŒã€ŒäºŒé‡å–å¾—ã€å•é¡Œã®ç¬¬ä¸€æ­©ğŸ‘£
ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå¢—ãˆã‚‹ã»ã©ã€åŒã˜APIãŒä½•å›ã‚‚é£›ã³ã¾ã™ğŸ˜µâ€ğŸ’«ğŸ’¦

---

## ã•ã‚‰ã«åœ°ç„ãŒæ·±ããªã‚‹ãƒã‚¤ãƒ³ãƒˆ ğŸ”¥ï¼ˆã‚ã‚‹ã‚ã‚‹ï¼‰

ä»Šã®ã‚³ãƒ¼ãƒ‰ã€ã¾ã åºç›¤ã®â€œã‹ã‚ã„ã„åœ°ç„â€ã§â€¦ã“ã“ã‹ã‚‰å¢—ãˆã‚‹ğŸ˜‡

* ğŸ” **å†å–å¾—ãƒœã‚¿ãƒ³**ã‚’ä»˜ã‘ãŸããªã‚‹
* ğŸ§Š **å‰å›çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥**ã—ãŸããªã‚‹ï¼ˆæˆ»ã£ãŸã‚‰å³è¡¨ç¤ºã—ãŸã„ï¼‰
* ğŸ• **ä½•ç§’ã”ã¨ã«è‡ªå‹•æ›´æ–°**ã—ãŸããªã‚‹ï¼ˆãƒãƒ£ãƒƒãƒˆ/æ ªä¾¡/é€šçŸ¥ãªã©ï¼‰
* ğŸ§  **åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’ç”»é¢å…¨ä½“ã§å…±æœ‰**ã—ãŸããªã‚‹
* ğŸ§· **ã€Œå¤ã„/æ–°ã—ã„ã€ã®åŸºæº–**ãŒæ¬²ã—ããªã‚‹ï¼ˆã„ã¤ã‚’ã‚‚ã£ã¦å¤ã„ï¼Ÿï¼‰
* ğŸ¯ **åŒæ™‚ã«æŠ¼ã•ã‚ŒãŸæ™‚ã®äºŒé‡é€ä¿¡é˜²æ­¢**ãŒæ¬²ã—ããªã‚‹ï¼ˆãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã¨ã‹ï¼‰

---

## å›³ã§è¦‹ã‚‹ï¼šäºŒé‡å–å¾—ãŒèµ·ãã‚‹ç†ç”± ğŸ§©ï¼ˆMermaidï¼‰

ã€Œéƒ¨å“ã”ã¨ã« useEffect ã§å–ã‚Šã«è¡Œãã€æ§‹é€ ã ã¨ã€ã“ã†ãªã‚‹ã‚ˆã€œğŸ˜­

```mermaid
flowchart TB
  A[App] --> B[PostCount]
  A --> C[PostList]
  B -->|useEffect fetch| D[(API)]
  C -->|useEffect fetch| D
  D --> E[åŒã˜ãƒ‡ãƒ¼ã‚¿ãŒ2å›å–å¾—]
```

---

## ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆâœ…ï¼ˆç†è§£ã§ããŸã‚‰å‹ã¡âœŒï¸ï¼‰

æ¬¡ã®ã†ã¡ã€Œæ‰‹å‹• fetch ãŒã—ã‚“ã©ã„ç†ç”±ã€ã¨ã—ã¦æ­£ã—ã„ã®ã¯ã©ã‚Œï¼Ÿï¼ˆè¤‡æ•°OKï¼‰ğŸ™‚

1. â³ ãƒ­ãƒ¼ãƒ‰ä¸­ã®çŠ¶æ…‹ãŒå¿…è¦
2. ğŸ§Š ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è‡ªåˆ†ã§ä½œã‚‹ã¨å¤§å¤‰
3. ğŸ” åŒã˜ãƒ‡ãƒ¼ã‚¿ãŒè¤‡æ•°å›å–å¾—ã•ã‚ŒãŒã¡
4. ğŸŒˆ React ã¯ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒç¦æ­¢ã•ã‚Œã¦ã„ã‚‹

ç­”ãˆï¼š**1, 2, 3** âœ…ï¼ˆ4ã¯ã‚¦ã‚½ã ã‚ˆã€œğŸ¤£ï¼‰

---

## æ¬¡ç« ã®äºˆå‘Š ğŸâœ¨

ç¬¬162ç« ã§ã¯ã€ä»Šæ—¥ã®åœ°ç„ã‚’ã€Œã»ã¼1è¡Œã€ã®ä¸–ç•Œã«æŒã£ã¦ã„ãã‚ˆğŸ˜†ğŸ’–

* ãƒ­ãƒ¼ãƒ‰ä¸­/ã‚¨ãƒ©ãƒ¼/ãƒ‡ãƒ¼ã‚¿
* ã‚­ãƒ£ãƒƒã‚·ãƒ¥
* äºŒé‡å–å¾—ã®é˜²æ­¢
* å†å–å¾—
  ã“ã®ã¸ã‚“ãŒ **ã¾ã¨ã‚ã¦è§£æ±º**ã—ã¯ã˜ã‚ã‚‹ğŸ”¥

---

ã‚‚ã—ã‚ˆã‘ã‚Œã°ã€æ¬¡ã®ç¬¬162ç« ã«å…¥ã‚‹å‰ã«ã²ã¨ã¤ã ã‘å®¿é¡ŒğŸ“âœ¨
DevTools ã® Network ã§ã€ŒåŒã˜URLãŒ2å›ã€å‡ºã¦ã‚‹ã‚¹ã‚¯ã‚·ãƒ§ã‚’æ’®ã‚‹ã¤ã‚‚ã‚Šã§çœºã‚ã¦ã¿ã¦ã­ğŸ‘€ğŸ“¡
ã€Œã‚ã€ã“ã‚Œã‚’æ¯å›æ‰‹å‹•ã§ç›´ã™ã®ç„¡ç†ã â€¦ã€ã£ã¦æ°—æŒã¡ã«ãªã‚ŒãŸã‚‰æº€ç‚¹ã§ã™ğŸ’¯ğŸ¤£
