# ç¬¬59ç« ï¼šè¦‹å¼µã‚Šãƒªã‚¹ãƒˆ `[]`

---

ã“ã®ç« ã§ã¯ã€

* `useEffect(() => { ... }, [])` ãŒã€Œæœ€åˆã®1å›ã ã‘ã‚„ã£ã¦ã­ã€ã¨ã„ã†æ„å‘³ã«ãªã‚‹ã“ã¨
* ã©ã‚“ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãã‚Œã‚’ä½¿ã†ã¨ä¾¿åˆ©ã‹
* ã€Œãªã‚“ã§ ESLint ã«æ€’ã‚‰ã‚Œã‚‹ã®ï¼ŸğŸ¥ºã€ã‚’ã–ã£ãã‚Šç†è§£ã™ã‚‹ã“ã¨
* Strict Mode ã ã¨ã€Œ2å›å‹•ã„ã¦ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã€ç†ç”±

ã‚’ã‚†ã‚‹ã€œãæŠ¼ã•ãˆã¦ã„ãã¾ã™ğŸ’ª

---

## 1ï¸âƒ£ ãŠã•ã‚‰ã„ï¼š`useEffect` ã¨ã€Œè¦‹å¼µã‚Šãƒªã‚¹ãƒˆã€ã£ã¦ï¼Ÿ

`useEffect` ã¯ã€Œç”»é¢ã®è¡¨ç¤ºä»¥å¤–ã®ä»•äº‹ï¼ˆå‰¯ä½œç”¨ï¼‰ã€ã‚’ã‚„ã‚‰ã›ã‚‹ãŸã‚ã®ãƒ•ãƒƒã‚¯ã§ã—ãŸã­ã€‚
ç¬¬58ç« ã§ã‚„ã£ãŸã¨ãŠã‚Šã€ç¬¬äºŒå¼•æ•°ã®ã€Œè¦‹å¼µã‚Šãƒªã‚¹ãƒˆï¼ˆä¾å­˜é…åˆ—ãƒ»dependency arrayï¼‰ã€ãŒ

* **ã„ã¤ãã®å‡¦ç†ã‚’ã‚‚ã†ä¸€åº¦å‹•ã‹ã™ã‹**

ã‚’æ±ºã‚ã¦ã„ã¾ã™ã€‚([react.dev][1])

ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦ã¯ã“ã‚“ãªæ„Ÿã˜ğŸ‘‡

* ä¾å­˜é…åˆ—ãªã—ï¼š`useEffect(() => { ... })`
  â†’ **æ¯å›ã®ãƒ¬ãƒ³ãƒ€ãƒ¼å¾Œã«** å®Ÿè¡Œ
* `[]`ï¼š`useEffect(() => { ... }, [])`
  â†’ **æœ€åˆã®1å›ã ã‘** å®Ÿè¡Œ
* `[someState]`ï¼š`useEffect(() => { ... }, [someState])`
  â†’ **æœ€åˆã®1å› + `someState` ãŒå¤‰ã‚ã‚‹ãŸã³** å®Ÿè¡Œ([Strapi][2])

ã“ã®ç« ã¯ã“ã®ã†ã¡
**ã€Œ`[]` ã‚’æ¸¡ã—ãŸã¨ãã€å°‚ç”¨**ã®ãŠè©±ã§ã™ğŸŒŸ

---

## 2ï¸âƒ£ `[]` ã®æ„å‘³ï¼šã€Œåˆå›ãƒã‚¦ãƒ³ãƒˆæ™‚ã ã‘ã‚„ã£ã¦ã­ã€

ã‚³ãƒ¼ãƒ‰ã®å½¢ã¯ã“ã‚ŒğŸ‘‡

```tsx
import { useEffect, useState } from "react";

function MountOnceDemo() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    console.log("ğŸ‰ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒåˆã‚ã¦è¡¨ç¤ºã•ã‚Œã¾ã—ãŸï¼");
  }, []); // â† è¦‹å¼µã‚Šãƒªã‚¹ãƒˆãŒç©ºï¼

  return (
    <div>
      <p>ã‚«ã‚¦ãƒ³ãƒˆ: {count}</p>
      <button onClick={() => setCount((prev) => prev + 1)}>
        ï¼‹1ã™ã‚‹
      </button>
    </div>
  );
}

export default MountOnceDemo;
```

ãƒã‚¤ãƒ³ãƒˆã¯ã“ã“ã§ã™ğŸ‘‡

* `useEffect(() => { ... }, [])`

  * **æœ€åˆã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒç”»é¢ã«å‡ºãŸã‚ã¨** ã«ã ã‘å®Ÿè¡Œ
  * ãã®å¾Œã€`count` ãŒä½•å›å¤‰ã‚ã£ã¦å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã•ã‚Œã¦ã‚‚
    â†’ ã“ã® Effect ã¯ **ã‚‚ã†å‘¼ã°ã‚Œãªã„**

ã‚¯ãƒ©ã‚¹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã„ã†ã¨ `componentDidMount` çš„ãªå‹•ãã¨æ€ã£ã¦OKã§ã™âœ¨([Strapi][2])

---

## 3ï¸âƒ£ å®Ÿé¨“ï¼šApp.tsx ã«çµ„ã¿è¾¼ã‚“ã§ã¿ã‚ˆã† ğŸ§ª

ã¡ã‚‡ã£ã¨ã ã‘æ‰‹ã‚’å‹•ã‹ã—ã¦ã€æŒ™å‹•ã‚’ä½“æ„Ÿã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### 3-1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã‚‹

`src/MountOnceDemo.tsx` ã‚’ä½œã£ã¦ã€ã•ã£ãã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒšã—ã¾ã™âœï¸

ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åã‚„ãƒ•ã‚©ãƒ«ãƒ€åã¯ãŠå¥½ãã«ã©ã†ãã€œï¼‰

### 3-2. `App.tsx` ã‹ã‚‰å‘¼ã³å‡ºã™

```tsx
import MountOnceDemo from "./MountOnceDemo";

function App() {
  return (
    <div>
      <h1>ç¬¬59ç« ãƒ†ã‚¹ãƒˆ âœ¨</h1>
      <MountOnceDemo />
    </div>
  );
}

export default App;
```

### 3-3. å‹•ãã‚’è¦³å¯Ÿ ğŸ‘€

1. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ `npm run dev` ã‚’å®Ÿè¡Œ
2. ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ãƒ—ãƒªã‚’é–‹ã
3. DevTools ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é–‹ã
4. ç”»é¢ãŒè¡¨ç¤ºã•ã‚ŒãŸç¬é–“ã«
   â†’ `ğŸ‰ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒåˆã‚ã¦è¡¨ç¤ºã•ã‚Œã¾ã—ãŸï¼` ãŒ **ä¸€åº¦ã ã‘** å‡ºã¦ã„ã‚‹ã¯ãš
5. ãƒœã‚¿ãƒ³ã‚’ä½•å›æŠ¼ã—ã¦ã‚‚
   â†’ ãƒ­ã‚°ã¯å¢—ãˆãªã„ï¼ˆ`useEffect` ã¯å‹•ã„ã¦ã„ãªã„ï¼‰

ã€Œåˆå›ã ã‘ä»•äº‹ã—ã¦ã€ã‚ã¨ã¯é™ã‹ã«ã—ã¦ã‚‹ã‚¹ã‚¿ãƒƒãƒ•ã€ã¿ãŸã„ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ğŸ¤µâ€â™€ï¸

---

## 4ï¸âƒ£ æ™‚ç³»åˆ—ã§è¦‹ã‚‹ï¼šMermaid å›³ã§ã‚¤ãƒ¡ãƒˆãƒ¬ ğŸ§ âœ¨

ã€Œã„ã¤å‹•ã„ã¦ã€ã„ã¤å‹•ã‹ãªã„ã®ã‹ã€ã‚’å›³ã§è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```mermaid
sequenceDiagram
    participant U as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant C as ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    participant E as useEffect( [], )

    U->>C: ãƒšãƒ¼ã‚¸ã‚’é–‹ãï¼ˆåˆå›ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼‰
    C->>E: ãƒ¬ãƒ³ãƒ€ãƒ¼å®Œäº†å¾Œã«å®Ÿè¡Œï¼
    Note right of E: ğŸ‰ åˆå›ã ã‘ã®å‡¦ç†ã‚’å®Ÿè¡Œ

    U->>C: ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§çŠ¶æ…‹æ›´æ–°
    C->>C: å†ãƒ¬ãƒ³ãƒ€ãƒ¼
    C-->>E: ä¾å­˜é…åˆ—ãŒ [] ãªã®ã§ãªã«ã‚‚èµ·ããªã„
    Note right of C: ãã‚Œä»¥é™ã¯\nEffectã¯å†å®Ÿè¡Œã•ã‚Œãªã„
```

* æœ€åˆã®ãƒ¬ãƒ³ãƒ€ãƒ¼å¾Œ â†’ `useEffect` ãŒ **1å›ã ã‘** å‹•ã
* ãã®ã‚ã¨ã®å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ã¯ â†’ `[]` ã®ãŠã‹ã’ã§ **å®Œå…¨ã‚¹ãƒ«ãƒ¼**

ã¨ã„ã†æµã‚ŒãŒã¤ã‹ã‚ã‚Œã°OKã§ã™ğŸ™†â€â™€ï¸

---

## 5ï¸âƒ£ ã©ã‚“ãªæ™‚ã« `[]` ã‚’ä½¿ã†ï¼ŸğŸ’¡

`[]` ã¯ã€Œ**åˆæœŸè¨­å®šã ã‘ã—ãŸã„ã¨ã**ã€ã«å‘ã„ã¦ã„ã¾ã™ã€‚

ä¾‹ã¨ã—ã¦ã¯â€¦

* âœ… ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ä¸€åº¦ã ã‘ãƒ­ã‚°ã‚’é€ã‚‹
* âœ… ä¸€åº¦ã ã‘ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²ã™ã‚‹ï¼ˆ`addEventListener` ãªã©ï¼‰
* âœ… ä¸€åº¦ã ã‘åˆæœŸå€¤ã‚’å¤–ã‹ã‚‰å–ã£ã¦ãã‚‹ï¼ˆ`localStorage` ã‹ã‚‰ãƒ†ãƒ¼ãƒè¨­å®šãªã©ï¼‰([DEV Community][3])

ãŸã ã—ã€**æ³¨æ„ãƒã‚¤ãƒ³ãƒˆ** ãŒã‚ã‚Šã¾ã™âš ï¸

### âš ï¸ ä¸­ã§ã€Œå¤‰ã‚ã‚‹å€¤ï¼ˆstate / propsï¼‰ã€ã‚’èª­ã‚€ã¨ãã¯è¦æ³¨æ„

`useEffect` ã®ä¾å­˜é…åˆ—ã¯ã€æœ¬æ¥

> ã€ŒEffectã®ä¸­ã§èª­ã‚€ *ã™ã¹ã¦ã®* çŠ¶æ…‹ã‚„propsã¯ã€ã“ã“ã«æ›¸ãã¾ã—ã‚‡ã†ã€

ã¨ã„ã†ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚([react.dev][1])

ã‚‚ã— `[]` ã«ã—ã¦ã„ã‚‹ã®ã«ã€ä¸­ã§ `count` ã‚’èª­ã‚“ã ã‚Šã™ã‚‹ã¨â€¦

* ESLint ã«
  â†’ *â€œReact Hook useEffect has a missing dependencyâ€*
  ã¿ãŸã„ã«æ€’ã‚‰ã‚ŒãŸã‚Šã—ã¾ã™ğŸ˜‡([KinstaÂ®][4])

ã“ã‚Œã¯

> ã€Œ`count` ã‚’èª­ã‚“ã§ã‚‹ã®ã«ã€`[count]` ã£ã¦æ›¸ã„ã¦ãªã„ã‚ˆï¼Ÿã€

ã¨ã„ã†æŒ‡æ‘˜ã§ã™ã€‚

**ãªã®ã§ `[]` ã§æ›¸ãã¨ãã¯**ï¼š

* ä¸€åº¦ãã‚Šã®åˆæœŸåŒ–
* å¤‰ã‚ã‚‰ãªã„å€¤ã ã‘ã‚’æ‰±ã†å‡¦ç†

ã«çµã‚‹ã®ãŒå®‰å…¨ã§ã™ğŸ’¡

---

## 6ï¸âƒ£ ã€Œãˆï¼Ÿ2å›å‹•ã„ã¦ãªã„ï¼Ÿã€Strict Mode ã®å°ãƒã‚¿ ğŸ¤”

React 18 ä»¥é™ã€é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ã§ `StrictMode` ãŒã‚ªãƒ³ã«ãªã£ã¦ã„ã‚‹ã¨

> **ãƒã‚¦ãƒ³ãƒˆ â†’ ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆ â†’ ã‚‚ã†ä¸€å›ãƒã‚¦ãƒ³ãƒˆ**

ã¨ã„ã†ã€Œã‚ã–ã¨ã®2å›è©¦ã—ã€ãŒè¡Œã‚ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
ãã®çµæœã€`useEffect(..., [])` ã®å‡¦ç†ãŒ **é–‹ç™ºä¸­ã ã‘ 2å›å‹•ã„ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹** ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚([OneClick IT Consultancy][5])

* æœ¬ç•ªãƒ“ãƒ«ãƒ‰ï¼ˆ`npm run build` â†’ deployï¼‰ã§ã¯
  â†’ é€šå¸¸ã©ãŠã‚Š **1å›ã ã‘** å®Ÿè¡Œ
* é–‹ç™ºä¸­ã ã‘ã€Œã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆã€ã•ã‚Œã¦ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ğŸ‹ï¸â€â™€ï¸

ãªã®ã§ã€

> ã€Œã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ãŒ2å›å‡ºã‚‹ã‚“ã ã‘ã©ï¼ï¼Ÿãƒã‚°ï¼ï¼Ÿã€

ã¨æ…Œã¦ãªãã¦å¤§ä¸ˆå¤«ã§ã™ã€‚
**Strict Mode ã®ä»•æ§˜** ã ã¨æ€ã£ã¦ãŠã„ã¦OKã§ã™âœ¨

---

## 7ï¸âƒ£ ãƒŸãƒ‹ç·´ç¿’ ğŸ“ï¼ˆè‡ªåˆ†ã§æ›¸ã„ã¦ã¿ã‚ˆã†ï¼‰

æ™‚é–“ãŒã‚ã‚Œã°ã€æ¬¡ã®2ã¤ã‚’è‡ªåˆ†ã§ä½œã£ã¦ã¿ã¦ãã ã•ã„ï¼š

### ğŸ… ç·´ç¿’1ï¼šã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´

1. `TitleOnMount.tsx` ã‚’ä½œã‚‹
2. ä¸­ã§ `useEffect(() => { document.title = "React v19 å‹‰å¼·ä¸­ğŸ“"; }, []);` ã‚’æ›¸ã
3. ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ãŸã¨ã **1å›ã ã‘** ã‚¿ã‚¤ãƒˆãƒ«ãŒå¤‰ã‚ã‚Œã°æˆåŠŸï¼

â†’ ã€Œã‚ã€ã“ã‚ŒãŒâ€œåˆå›ã ã‘â€ã‹ã€œã€ãŒå®Ÿæ„Ÿã§ãã‚Œã°OKã€‚

### ğŸ… ç·´ç¿’2ï¼šä¸€åº¦ã ã‘ã‚¢ãƒ©ãƒ¼ãƒˆ

1. `AlertOnMount.tsx` ã‚’ä½œã‚‹
2. `useEffect` ã®ä¸­ã§ `alert("ã‚ˆã†ã“ãï¼ã“ã®ãƒšãƒ¼ã‚¸ã¯ç¬¬59ç« ã®ç·´ç¿’ãƒšãƒ¼ã‚¸ã§ã™âœ¨");`
3. å†ãƒ¬ãƒ³ãƒ€ãƒ¼ã—ã¦ã‚‚ï¼ˆãƒœã‚¿ãƒ³æŠ¼ã—ã¦ã‚‚ï¼‰ã‚¢ãƒ©ãƒ¼ãƒˆãŒ **å¢—ãˆãªã„** ã“ã¨ã‚’ç¢ºèª

---

## ã¾ã¨ã‚ ğŸ€

* `useEffect(() => { ... }, [])`
  â†’ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ **æœ€åˆã«ç”»é¢ã«å‡ºãŸã¨ãã ã‘** å®Ÿè¡Œã•ã‚Œã‚‹
* åˆæœŸè¨­å®šã‚„ä¸€åº¦ãã‚Šã®å‡¦ç†ã«ä½¿ã†ã¨ä¾¿åˆ©âœ¨
* ä¸­ã§ã€Œå¤‰ã‚ã‚‹å€¤ã€ã‚’èª­ã‚€ãªã‚‰ã€æœ¬æ¥ã¯ä¾å­˜é…åˆ—ã«æ›¸ãå¿…è¦ãŒã‚ã‚‹
* Strict Mode ã®ã›ã„ã§ã€é–‹ç™ºä¸­ã ã‘2å›å‹•ã„ã¦ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã‘ã©
  â†’ æœ¬ç•ªã§ã¯1å›ãªã®ã§ã‚ã‚ã¦ãªãã¦OKğŸ‘Œ

æ¬¡ã®ç« ã§ã¯ã€`[state]` ã¿ãŸã„ã«ã€Œ**ç‰¹å®šã®å€¤ãŒå¤‰ã‚ã£ãŸã¨ãã ã‘å‹•ã**ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚
`[]` ã¨ `[something]` ã®é•ã„ãŒåˆ†ã‹ã‚‹ã¨ã€`useEffect` ãŒä¸€æ°—ã«æ‰±ã„ã‚„ã™ããªã‚Šã¾ã™ã‚ˆã€œğŸŒˆ

[1]: https://react.dev/reference/react/useEffect?utm_source=chatgpt.com "useEffect"
[2]: https://strapi.io/blog/what-is-react-useeffect-hook-complete-guide?utm_source=chatgpt.com "What is React useEffect - Complete Guide and Examples"
[3]: https://dev.to/joodi/stop-misusing-useeffect-in-react-1g5o?utm_source=chatgpt.com "Stop Misusing useEffect in React! ğŸš¨"
[4]: https://kinsta.com/blog/react-hook-useeffect-has-a-missing-dependency/?utm_source=chatgpt.com "How To Fix the â€œReact Hook useEffect Has a Missing ..."
[5]: https://www.oneclickitsolution.com/centerofexcellence/reactjs/how-to-handle-useeffect-running-multiple-times-in-react?utm_source=chatgpt.com "Why useEffect Runs Multiple Times in React and How to Fix It"
