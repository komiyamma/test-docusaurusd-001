# ç¬¬160ç« ï¼šVercel / Cloudflare Pages ã§ãƒãƒƒãƒˆã«å…¬é–‹ï¼

ã“ã®ç« ã®ã‚´ãƒ¼ãƒ«ã¯ã€Œ**ã„ã¾ä½œã£ã¦ã‚‹Reactã‚¢ãƒ—ãƒªã‚’ã€URLã§èª°ã§ã‚‚è¦‹ã‚‰ã‚Œã‚‹çŠ¶æ…‹ã«ã™ã‚‹**ã€ã“ã¨ã ã‚ˆã€œï¼âœ¨
ï¼ˆViteã§ä½œã£ãŸReactã‚¢ãƒ—ãƒªå‰æã§é€²ã‚ã‚‹ã­ï¼‰

---

## å…¬é–‹ã¾ã§ã®å…¨ä½“åƒï¼ˆã–ã£ãã‚Šï¼‰ğŸ—ºï¸âœ¨

```mermaid
flowchart LR
  A[PCã§é–‹ç™ºğŸ§‘â€ğŸ’»] --> B[GitHubã¸pushğŸ™]
  B --> C{ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã‚’é¸ã¶ğŸ¤”}
  C -->|Vercel| D[VercelãŒè‡ªå‹•ãƒ“ãƒ«ãƒ‰âš™ï¸]
  C -->|Cloudflare Pages| E[PagesãŒè‡ªå‹•ãƒ“ãƒ«ãƒ‰âš™ï¸]
  D --> F[distã‚’å…¬é–‹ğŸ“¦]
  E --> G[distã‚’å…¬é–‹ğŸ“¦]
  F --> H[URLã§è¦‹ã‚Œã‚‹ğŸŠ]
  G --> H
```

---

## 0) å…¬é–‹å‰ãƒã‚§ãƒƒã‚¯ï¼ˆè¶…å¤§äº‹ï¼‰âœ…ğŸ”

1. ã¾ãšãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ï¼Ÿ

```bash
npm run build
```

2. æœ¬ç•ªã£ã½ã„è¡¨ç¤ºã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ç¢ºèªï¼ˆè¶…ãŠã™ã™ã‚ï¼‰ğŸ‘€

```bash
npm run preview
```

* ã“ã“ã§è¡¨ç¤ºãŒå´©ã‚Œã‚‹ãªã‚‰ã€å…¬é–‹ã—ã¦ã‚‚å´©ã‚Œã‚‹å¯èƒ½æ€§é«˜ã„ã‚ˆã€œï¼ğŸ˜­

---

## A) Vercelã§å…¬é–‹ã™ã‚‹æ‰‹é †ğŸš€â–²

### 1) GitHubã«pushã™ã‚‹ï¼ˆã¾ã ãªã‚‰ï¼‰ğŸ™

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆã§ï¼š

```bash
git init
git add .
git commit -m "first deploy"
```

GitHubã«ãƒªãƒã‚¸ãƒˆãƒªä½œã£ã¦ã€æ¡ˆå†…ã©ãŠã‚Šã« `git remote add ...` â†’ `git push` ã¾ã§ã‚„ã£ã¦ã­âœ¨

---

### 2) Vercelã§Importã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ğŸŒŸ

* Vercelã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ **Add New â†’ Project**
* GitHubé€£æºã—ã¦ãƒªãƒã‚¸ãƒˆãƒªé¸ã¶
* ã ã„ãŸã„è‡ªå‹•ã§ã€ŒViteã€åˆ¤å®šã—ã¦ãã‚Œã‚‹ã‚ˆ ğŸ‘ï¼ˆVercelã¯Viteå‘ã‘ã‚¬ã‚¤ãƒ‰ã‚‚ç”¨æ„ã—ã¦ã‚‹ã‚ˆï¼‰ ([Vercel][1])
* Build Command ã¯åŸºæœ¬ `npm run build`
* Output Directory ã¯åŸºæœ¬ `dist`

ãƒ‡ãƒ—ãƒ­ã‚¤ã§ããŸã‚‰ã€URLãŒç™ºè¡Œã•ã‚Œã‚‹ã‚ˆã€œï¼ğŸŠ

---

## B) Cloudflare Pagesã§å…¬é–‹ã™ã‚‹æ‰‹é †ğŸŒ©ï¸ğŸ“„

Cloudflareå…¬å¼ã®ã€ŒViteãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚¬ã‚¤ãƒ‰é€šã‚Šã«ã„ãã®ãŒä¸€ç•ªå®‰å…¨âœ¨ ([Cloudflare Docs][2])

### 1) Pagesãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆğŸ§°

* Cloudflare Dashboard â†’ **Workers & Pages**
* **Create application â†’ Pages â†’ Import from Git**
* GitHubãƒªãƒã‚¸ãƒˆãƒªé¸æŠ
* è¨­å®šã§ğŸ‘‡

  * Build command: `npm run build`
  * Build output directory: `dist` ([Cloudflare Docs][2])

ä¿å­˜ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ï¼
`<ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå>.pages.dev` ãŒã‚‚ã‚‰ãˆã‚‹ã‚ˆğŸ‰ ([Cloudflare Docs][2])

---

## âš ï¸ ç½ ï¼šReact Router ã‚’ä½¿ã£ã¦ã‚‹ã¨ã€Œç›´URL/æ›´æ–°ã€ã§404ã«ãªã‚ŠãŒã¡ ğŸ˜­ğŸ”

ä¾‹ãˆã° `/users/123` ã‚’ **ç›´ã§é–‹ã** or **æ›´æ–°** ã™ã‚‹ã¨â€¦é™çš„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã¯ã€Œãã‚“ãªãƒ•ã‚¡ã‚¤ãƒ«ç„¡ã„ã‚ˆï¼Ÿã€ã£ã¦ãªã‚ŠãŒã¡ğŸ’¦

```mermaid
sequenceDiagram
  participant U as User
  participant H as Hosting(é™çš„)
  U->>H: GET /users/123
  alt å¯¾ç­–ãªã—
    H-->>U: 404 Not Found
  else å¯¾ç­–ã‚ã‚Š
    H-->>U: index.html ã‚’è¿”ã™(200)
    U->>U: React RouterãŒ /users/123 ã‚’è¡¨ç¤ºâœ¨
  end
```

### âœ… Vercelã§ã®å¯¾ç­–ï¼šå…¨ãƒ«ãƒ¼ãƒˆã‚’ `index.html` ã«ãƒªãƒ©ã‚¤ãƒˆ

Vercelã¯ã€ŒSPAã ã¨deep linkingãŒãã®ã¾ã¾ã ã¨å‹•ã‹ãªã„ã“ã¨ãŒã‚ã‚‹ã€ã£ã¦èª¬æ˜ã—ã¦ã¦ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§å¯¾å¿œã™ã‚‹æµã‚Œã ã‚ˆ ([Vercel][1])

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã« `vercel.json` ã‚’ä½œã£ã¦ğŸ‘‡

```json
{
  "rewrites": [{ "source": "/(.*)", "destination": "/index.html" }]
}
```

ã“ã‚Œã§ `/(ãªã‚“ã§ã‚‚)` ã«æ¥ã¦ã‚‚ `index.html` ã‚’è¿”ã—ã¦ã€React Routerã«ãƒãƒˆãƒ³ã‚¿ãƒƒãƒã§ãã‚‹ğŸ’ªâœ¨

---

### âœ… Cloudflare Pagesã§ã®å¯¾ç­–ï¼š`_redirects` ã‚’ç½®ãï¼ˆSPAå‘ã‘ï¼‰

Cloudflare Pagesã¯ `_redirects` ã£ã¦ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ã‘ã‚‹ã‚ˆï¼ˆç½®ãå ´æ‰€ã‚„æ›¸å¼ã‚‚å…¬å¼ã«èª¬æ˜ã‚ã‚Šï¼‰ ([Cloudflare Docs][3])

`public/_redirects` ã‚’ä½œã£ã¦ã€1è¡Œã ã‘ğŸ‘‡

```text
/* /index.html 200
```

* `public/` ã«ç½®ãã¨ã€ãƒ“ãƒ«ãƒ‰å¾Œã« `dist/` ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã‚„ã™ã„ã‹ã‚‰æ¥½ã¡ã‚“ï¼ˆå…¬å¼ã‚‚ã€Œpublic/staticã«ç½®ãã®ãŒè‰¯ã„ã€ã£ã¦æµã‚Œï¼‰ ([Cloudflare Docs][3])

---

## ç’°å¢ƒå¤‰æ•°ï¼ˆã¡ã‚‡ã„å¤§äººã®è©±ï¼‰ğŸ”âœ¨

Viteã¯ **`VITE_` ã§å§‹ã¾ã‚‹ç’°å¢ƒå¤‰æ•°ã ã‘** ãŒãƒ•ãƒ­ãƒ³ãƒˆã«å…¬é–‹ã•ã‚Œã‚‹ä»•æ§˜ã ã‚ˆï¼ˆå®‰å…¨ã®ãŸã‚ï¼ï¼‰ ([vitejs][4])

ä¾‹ï¼š`.env`ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç”¨ï¼‰

```env
VITE_APP_NAME=My Super App
```

ä½¿ã†å´ï¼š

```ts
console.log(import.meta.env.VITE_APP_NAME);
```

* Vercel / Cloudflare Pages ã§ã‚‚ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã§ãã‚‹ã‚ˆ
* ãŸã ã—ï¼ãƒ•ãƒ­ãƒ³ãƒˆã«å…¥ã‚ŒãŸæ™‚ç‚¹ã§ã€Œç§˜å¯†ã€ã«ã¯ã§ããªã„ã®ã§ã€APIã‚­ãƒ¼ç³»ã¯åŸºæœ¬ç½®ã‹ãªã„ã§ã­ğŸ™…â€â™€ï¸ğŸ’¦ï¼ˆç½®ããªã‚‰ã‚µãƒ¼ãƒãƒ¼å´ãŒå¿…è¦ï¼‰

---

## ãƒŸãƒ‹èª²é¡Œï¼ˆã‚´ãƒ¼ãƒ«ã®å„€å¼ğŸğŸ€ï¼‰

1. ã„ã¾ã¾ã§ä½œã£ãŸã‚¢ãƒ—ãƒªã‚’ **Vercel ã‹ Pages ã®ã©ã£ã¡ã‹**ã§å…¬é–‹ã™ã‚‹ğŸ‰
2. React Routerä½¿ã£ã¦ã‚‹ãªã‚‰ã€`/some/path` ã‚’ç›´æ‰“ã¡ã—ã¦ã‚‚é–‹ã‘ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ğŸ”âœ…
3. `VITE_APP_NAME` ã‚’è¨­å®šã—ã¦ã€ç”»é¢ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¡¨ç¤ºã—ã¦ã¿ã¦ã­âœ¨ğŸª„

---

## ãŠã¤ã‹ã‚Œã•ã¾ï¼ç¬¬160ç« ã‚¯ãƒªã‚¢ï¼ğŸŠğŸ¥³âœ¨

ã“ã“ã¾ã§æ¥ãŸã‚‰ã€ã‚‚ã†ã€Œä½œã‚‹ â†’ ãƒ†ã‚¹ãƒˆ â†’ å…¬é–‹ã€ã¾ã§ä¸€é€šã‚Šã§ãã‚‹äººã ã‚ˆã€œï¼ãˆã‚‰ã„ï¼ğŸ«¶ğŸŒ¸

[1]: https://vercel.com/docs/frameworks/frontend/vite "Vite on Vercel"
[2]: https://developers.cloudflare.com/pages/framework-guides/deploy-a-vite3-project/ "Vite 3 Â· Cloudflare Pages docs"
[3]: https://developers.cloudflare.com/pages/configuration/redirects/ "Redirects Â· Cloudflare Pages docs"
[4]: https://vite.dev/guide/env-and-mode "Env Variables and Modes | Vite"
