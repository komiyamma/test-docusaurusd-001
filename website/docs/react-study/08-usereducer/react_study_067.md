# ç¬¬67ç« ï¼šã€ãƒ•ãƒƒã‚¯ã€‘`useReducer` ã®åŸºæœ¬ï¼ˆã€ŒæŒ‡ç¤ºæ›¸ã€ã§çŠ¶æ³ã‚’å¤‰ãˆã‚‹ä»•çµ„ã¿ï¼‰ğŸ§ âœ¨

## ã“ã®ç« ã§ã‚ã‹ã‚‹ã“ã¨ğŸ’¡

* `useReducer` ãŒã€Œä½•ã®ãŸã‚ã«ã‚ã‚‹ã®ã‹ã€âœ…
* `state / action / reducer / dispatch` ã®é–¢ä¿‚âœ…
* ã„ã¡ã°ã‚“å°ã•ã„å®Ÿç”¨ä¾‹ï¼ˆã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼‰ã‚’ä½œã‚Œã‚‹âœ…

---

## 1) `useReducer` ã£ã¦ãªã«ï¼ŸğŸ¤”

ä¸€è¨€ã§ã„ã†ã¨â€¦

**ã€ŒçŠ¶æ…‹ï¼ˆstateï¼‰ã‚’ã€ãƒ«ãƒ¼ãƒ«ï¼ˆreducerï¼‰ã«æ²¿ã£ã¦ã€æŒ‡ç¤ºï¼ˆactionï¼‰ã§æ›´æ–°ã™ã‚‹ä»•çµ„ã¿ã€**ã ã‚ˆã€œğŸ“âœ¨

`useState` ã¯ã€Œç›´æ¥ set ã™ã‚‹ã€æ„Ÿã˜ã ã‘ã©ã€`useReducer` ã¯â€¦

* âœ… **æŒ‡ç¤ºæ›¸ï¼ˆactionï¼‰ã‚’æŠ•ã’ã‚‹**
* âœ… **æ›´æ–°ãƒ«ãƒ¼ãƒ«ï¼ˆreducerï¼‰ãŒåˆ¤æ–­ã™ã‚‹**
* âœ… **æ–°ã—ã„ state ã‚’è¿”ã™**

ã£ã¦ã„ã†æµã‚Œã«ãªã‚‹ã‚ˆğŸ§¸ğŸ’•

---

## 2) ç™»å ´äººç‰©ã¯ã“ã®4äººï¼ğŸ§‘â€ğŸ¤â€ğŸ§‘

* **state**ï¼šä»Šã®çŠ¶æ…‹ï¼ˆä¾‹ï¼šã‚«ã‚¦ãƒ³ãƒˆã®æ•°å­—ï¼‰ğŸ”¢
* **action**ï¼šã‚„ã‚ŠãŸã„ã“ã¨ã®æŒ‡ç¤ºï¼ˆä¾‹ï¼šå¢—ã‚„ã™ãƒ»æ¸›ã‚‰ã™ï¼‰ğŸ“©
* **reducer**ï¼šæ›´æ–°ãƒ«ãƒ¼ãƒ«ï¼ˆã€Œã“ã®æŒ‡ç¤ºãªã‚‰ã“ã†å¤‰ãˆã‚‹ã€ï¼‰ğŸ“œ
* **dispatch**ï¼šaction ã‚’ reducer ã«å±Šã‘ã‚‹ä¿‚ğŸ“®

---

## 3) ã©ã‚“ãªæµã‚Œã§å‹•ãã®ï¼Ÿï¼ˆå›³è§£ï¼‰ğŸ—ºï¸

```mermaid
flowchart LR
  UI[ãƒœã‚¿ãƒ³æŠ¼ã™ğŸ–±ï¸] --> D[dispatch(action)ğŸ“®]
  D --> R[reducer(state, action)ğŸ“œ]
  R --> NS[æ–°ã—ã„ state ã‚’è¿”ã™âœ¨]
  NS --> UI2[ç”»é¢ãŒæ›´æ–°ã•ã‚Œã‚‹ğŸª„]
```

ã€ŒUIã¯â€œæŒ‡ç¤ºã‚’å‡ºã™ã ã‘â€ã€ã§ã€**åˆ¤æ–­ã¯ reducer ãŒæ‹…å½“**ã£ã¦æ„Ÿã˜ã ã­ğŸ˜ºğŸ‘

---

## 4) ã¾ãšã¯æœ€å°ã®ã‚µãƒ³ãƒ—ãƒ«ï¼š`useReducer` ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ğŸ®âœ¨

### âœ… `App.tsx` ã‚’ã“ã‚Œã«ã—ã¦ã¿ã‚ˆã†

```tsx
import { useReducer } from "react";

type State = { count: number };

type Action =
  | { type: "inc" }
  | { type: "dec" }
  | { type: "reset" };

const initialState: State = { count: 0 };

function reducer(state: State, action: Action): State {
  switch (action.type) {
    case "inc":
      return { count: state.count + 1 };
    case "dec":
      return { count: state.count - 1 };
    case "reset":
      return { count: 0 };
    default:
      // ã“ã“ã«ã¯åŸºæœ¬æ¥ãªã„ï¼ˆActionã®å‹ã§å®ˆã‚‰ã‚Œã¦ã‚‹ï¼‰ã‘ã©ä¿é™ºğŸ›¡ï¸
      return state;
  }
}

export default function App() {
  const [state, dispatch] = useReducer(reducer, initialState);

  return (
    <div style={{ padding: 24, fontFamily: "system-ui" }}>
      <h1>useReducer ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼âœ¨</h1>

      <p style={{ fontSize: 24 }}>
        count: <b>{state.count}</b> ğŸ”¢
      </p>

      <div style={{ display: "flex", gap: 8 }}>
        <button onClick={() => dispatch({ type: "dec" })}>-1 ğŸ‘‡</button>
        <button onClick={() => dispatch({ type: "inc" })}>+1 ğŸ‘†</button>
        <button onClick={() => dispatch({ type: "reset" })}>ãƒªã‚»ãƒƒãƒˆ ğŸ”„</button>
      </div>
    </div>
  );
}
```

### âœ… ãƒã‚¤ãƒ³ãƒˆè§£èª¬ï¼ˆã“ã“è¶…å¤§äº‹ï¼‰ğŸ’–

* `useReducer(reducer, initialState)` ã®æˆ»ã‚Šå€¤ã¯ **`[state, dispatch]`** ğŸ
* ãƒœã‚¿ãƒ³ã¯ `dispatch({ type: "inc" })` ã¿ãŸã„ã« **æŒ‡ç¤ºã‚’æŠ•ã’ã‚‹ã ã‘**ğŸ“®
* `reducer` ãŒã€Œã˜ã‚ƒã‚ã“ã†æ›´æ–°ã­ï¼ã€ã£ã¦ **æ–°ã—ã„ state ã‚’è¿”ã™**ğŸª„
* **state ã‚’ç›´æ¥æ›¸ãæ›ãˆãªã„**ï¼ˆ`state.count++` ã¿ãŸã„ãªã®ã¯NGï¼‰ğŸ™…â€â™€ï¸

---

## 5) â€œæŒ‡ç¤ºæ›¸â€ã£ã¦ã“ã†ã„ã†ã“ã¨ï¼ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸å›³ï¼‰ğŸ“¦

```mermaid
sequenceDiagram
  participant U as ã‚ãªãŸï¼ˆUIï¼‰ğŸ§‘â€ğŸ“
  participant D as dispatchğŸ“®
  participant R as reducerğŸ“œ
  participant S as stateğŸ”¢

  U->>D: { type: "inc" } ã‚’é€ã‚‹
  D->>R: reducer(state, action) å‘¼ã¶
  R->>S: æ–°ã—ã„ state ã‚’ä½œã£ã¦è¿”ã™
  S-->>U: ç”»é¢ã® count ãŒæ›´æ–°âœ¨
```

---

## 6) ã„ã¤ `useReducer` ã‚’ä½¿ã†ã®ï¼ŸğŸ§­

`useState` ã§ã‚‚ã„ã‘ã‚‹ã‘ã©ã€ã“ã†ã„ã†æ™‚ã« `useReducer` ãŒå¼·ã„ã‚ˆğŸ’ªâœ¨

* âœ… çŠ¶æ…‹ãŒå¢—ãˆã¦ãã¦æ›´æ–°ãŒã‚´ãƒãƒ£ã¤ãğŸ˜µâ€ğŸ’«
* âœ… æ›´æ–°ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¤šã„ï¼ˆè¿½åŠ /å‰Šé™¤/ç·¨é›†/ãƒªã‚»ãƒƒãƒˆâ€¦ï¼‰ğŸ“š
* âœ… ã€Œæ›´æ–°ãƒ«ãƒ¼ãƒ«ã‚’1ã‹æ‰€ã«é›†ã‚ãŸã„ã€ğŸ§¹

---

## 7) ãƒŸãƒ‹ç·´ç¿’å•é¡Œï¼ˆãã®å ´ã§å¼·ããªã‚‹ï¼‰ğŸ‹ï¸â€â™€ï¸âœ¨

### ç·´ç¿’â‘ ï¼šã€Œ+10ã€ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã—ã¦ã¿ã‚ˆã†â•ğŸ”Ÿ

ãƒ’ãƒ³ãƒˆï¼šAction ã« `{ type: "inc10" }` ã‚’è¶³ã—ã¦ã€reducer ã« case ã‚’è¿½åŠ ğŸ’¡

### ç·´ç¿’â‘¡ï¼šã€Œ0ã‚ˆã‚Šä¸‹ã«è¡Œã‹ãªã„ã€ãƒ«ãƒ¼ãƒ«ã‚’å…¥ã‚Œã‚ˆã†ğŸ›‘

ãƒ’ãƒ³ãƒˆï¼š`dec` ã®ã¨ã“ã‚ã§ `Math.max(0, state.count - 1)` ã‚’ä½¿ã†ã¨æ¥½ã¡ã‚“ğŸ˜º

---

## 8) ã‚ˆãã‚ã‚‹ãƒŸã‚¹é›†ï¼ˆå…ˆã«æ½°ã™ğŸ§¨â†’âœ…ï¼‰

* âŒ reducer ã®ä¸­ã§ `state.count++` ã—ã¡ã‚ƒã†

  * âœ… **å¿…ãšæ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™**ï¼ˆ`return { count: ... }`ï¼‰
* âŒ reducer ã®ä¸­ã§ `alert()` ã¨ã‹é€šä¿¡ã¨ã‹ã€Œåˆ¥ã®ä»•äº‹ã€ã‚’ã™ã‚‹

  * âœ… reducer ã¯åŸºæœ¬ **è¨ˆç®—ã ã‘ã®â€œç´”ç²‹é–¢æ•°â€**ã«ã™ã‚‹ï¼ˆè½ã¡ç€ã„ã¦ã‚‹å­ï¼‰ğŸ§˜â€â™€ï¸

---

## ã¾ã¨ã‚ğŸ€

* `useReducer` ã¯ **ã€ŒæŒ‡ç¤ºï¼ˆactionï¼‰â†’ ãƒ«ãƒ¼ãƒ«ï¼ˆreducerï¼‰â†’ æ–°ã—ã„çŠ¶æ…‹ï¼ˆstateï¼‰ã€** ã®æµã‚Œâœ¨
* UIã¯ dispatch ã™ã‚‹ã ã‘ã§ã‚¹ãƒƒã‚­ãƒªã™ã‚‹ã‚ˆğŸ§¼ğŸ’•
* æ¬¡ã®ç« ï¼ˆç¬¬68ç« ï¼‰ã§ **Stateå‹ã¨Actionå‹ã‚’ã‚‚ã£ã¨ã‚¬ãƒƒãƒãƒª**ã‚„ã£ã¦ã€ã•ã‚‰ã«å¼·ããªã‚‹ã‚ˆğŸ”¥ğŸ˜Š
